const fs = require("node:fs");
const path = require("node:path");

const root = process.cwd();
const lessonsRoot = path.join(root, "assets", "lessons");

const css = [
":root {",
"    color-scheme: dark;",
"    --lesson-bg: var(--fazide-token-bg, var(--fazide-sandbox-bg, #0b1220));",
"    --lesson-fg: var(--fazide-token-fg, var(--fazide-sandbox-fg, #e2e8f0));",
"    --lesson-muted: var(--fazide-token-muted, var(--fazide-sandbox-muted, #9fb2c9));",
"    --lesson-border: var(--fazide-token-border, var(--fazide-sandbox-border, rgba(148,163,184,.35)));",
"    --lesson-panel: var(--fazide-token-panel, var(--fazide-sandbox-panel, #0f172a));",
"    --lesson-accent: var(--fazide-token-accent, var(--fazide-sandbox-accent, #38bdf8));",
"}",
"* { box-sizing: border-box; }",
"html, body { margin: 0; min-height: 100%; }",
"body {",
"    font-family: \"Space Grotesk\", \"Segoe UI\", system-ui, -apple-system, sans-serif;",
"    color: var(--lesson-fg);",
"    background: linear-gradient(180deg, color-mix(in srgb, var(--lesson-bg) 92%, black), var(--lesson-bg));",
"    padding: 20px;",
"}",
".lesson { width: min(920px, 100%); margin: 0 auto; border: 1px solid var(--lesson-border); background: color-mix(in srgb, var(--lesson-panel) 92%, transparent); padding: 18px; display: grid; gap: 14px; }",
".lesson h1 { margin: 0; font-size: 1.4rem; }",
".lesson p { margin: 0; color: var(--lesson-muted); }",
".lesson-grid { display: grid; grid-template-columns: minmax(0,1fr) minmax(220px,320px); gap: 14px; }",
".card { border: 1px solid var(--lesson-border); background: color-mix(in srgb, var(--lesson-panel) 96%, transparent); padding: 12px; display: grid; gap: 8px; }",
"#app { min-height: 120px; border: 1px dashed var(--lesson-border); padding: 10px; }",
"button, input, select { border: 1px solid var(--lesson-border); background: color-mix(in srgb, var(--lesson-panel) 88%, transparent); color: var(--lesson-fg); padding: 8px 10px; }",
"@media (max-width: 860px) { .lesson-grid { grid-template-columns: 1fr; } }",
].join("\n");

const lessons = [
  ["beginner-js-01-variables-output", "Beginner JS 01: Variables + Output", "Variables and output", ["Declare constants", "Build a message", "Render to preview"], "vars"],
  ["beginner-js-02-strings-templates", "Beginner JS 02: Strings + Formatting", "Strings and formatting", ["Trim input", "Format text", "Render summary"], "strings"],
  ["beginner-js-03-conditions-score-label", "Beginner JS 03: Conditionals", "if/else decisions", ["Set score", "Map score label", "Render result"], "conditions"],
  ["beginner-js-04-functions-greeter", "Beginner JS 04: Functions", "Function parameters", ["Create function", "Call function", "Render outputs"], "functions"],
  ["beginner-js-05-functions-return-tax", "Beginner JS 05: Return Values", "Function returns", ["Build helper", "Compute totals", "Render values"], "returns"],
  ["beginner-js-06-arrays-task-list", "Beginner JS 06: Arrays", "Array basics", ["Create array", "Push item", "Render list"], "arrays"],
  ["beginner-js-07-arrays-map-render", "Beginner JS 07: map + join", "Transform data", ["Create source values", "Map to labels", "Render labels"], "map"],
  ["beginner-js-08-objects-profile-card", "Beginner JS 08: Objects", "Object properties", ["Create object", "Read properties", "Render card"], "objects"],
  ["beginner-js-09-dom-query-update", "Beginner JS 09: DOM Query", "DOM updates", ["Seed nodes", "Select nodes", "Update nodes"], "dom"],
  ["beginner-js-10-events-click-counter", "Beginner JS 10: Click Events", "Event listeners", ["Create UI", "Track state", "Update on click"], "events"],
  ["beginner-js-11-form-live-preview", "Beginner JS 11: Input Events", "Live preview", ["Create input", "Listen to typing", "Render preview"], "input"],
  ["beginner-js-12-filtered-search-list", "Beginner JS 12: Filtering", "Array filter", ["Create data", "Filter by query", "Render filtered list"], "filter"],
  ["beginner-js-13-timer-controls", "Beginner JS 13: Timers", "setInterval basics", ["Create timer UI", "Start timer", "Stop timer"], "timer"],
  ["beginner-js-14-random-quote-generator", "Beginner JS 14: Random Choice", "Random index", ["Create source list", "Pick random value", "Render quote"], "random"],
  ["beginner-js-15-theme-safe-toggle", "Beginner JS 15: Theme-safe Toggle", "State + data attributes", ["Create toggle UI", "Flip boolean state", "Update text + dataset"], "toggle"],
  ["beginner-js-16-mini-calculator", "Beginner JS 16: Mini Calculator", "Number parsing", ["Create numeric inputs", "Read values", "Render sum/product"], "calc"],
  ["beginner-js-17-scoreboard-tracker", "Beginner JS 17: Scoreboard", "State object + render", ["Create score state", "Update state", "Re-render board"], "score"],
];

const lessonGoals = {
  vars: "Build confidence with variables and string output.",
  strings: "Format user-facing strings cleanly and safely.",
  conditions: "Use decision branches to classify input values.",
  functions: "Write reusable logic with parameters.",
  returns: "Compose helper functions that return computed values.",
  arrays: "Store sequential data and render it efficiently.",
  map: "Transform collections into display-ready content.",
  objects: "Model real data with object properties.",
  dom: "Query and update document nodes with intent.",
  events: "Connect user actions to application state.",
  input: "Mirror user input into live UI feedback.",
  filter: "Filter datasets in real-time by query.",
  timer: "Control repeated tasks with timers.",
  random: "Select values unpredictably from a source list.",
  toggle: "Track and reflect boolean UI state changes.",
  calc: "Parse numeric input and compute output.",
  score: "Manage mutable state and re-render views.",
};

function esc(text) {
  return String(text).replace(/[&<>\"]/g, (ch) => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[ch]));
}

function html(title, subtitle, checks, goal) {
  const checklist = checks.map((c) => `                        <li>${esc(c)}</li>`).join("\n");
  return [
"<!doctype html>",
"<html lang=\"en\">",
"<head>",
"    <meta charset=\"utf-8\" />",
"    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />",
`    <title>${esc(title)}</title>`,
"    <link rel=\"stylesheet\" href=\"styles.css\" />",
"</head>",
"<body>",
"    <main class=\"lesson\">",
`        <h1>${esc(title)}</h1>`,
`        <p>${esc(subtitle)}</p>`,
`        <p><strong>Goal:</strong> ${esc(goal || "Practice one focused JavaScript concept.")}</p>`,
"        <div class=\"lesson-grid\">",
"            <section class=\"card\">",
"                <h2 style=\"margin:0;font-size:1rem;\">Live Preview</h2>",
"                <div id=\"app\" aria-live=\"polite\">Run after completing JS steps.</div>",
"                <p style=\"margin:0;\"><strong>Success:</strong> The preview updates and the concept behavior is visible.</p>",
"            </section>",
"            <aside class=\"card\">",
"                <h2 style=\"margin:0;font-size:1rem;\">Guided Steps</h2>",
"                <ol style=\"margin:0;padding-left:20px;display:grid;gap:6px;\">",
checklist,
"                </ol>",
"            </aside>",
"        </div>",
"    </main>",
"    <script src=\"app.js\"></script>",
"</body>",
"</html>",
"",
  ].join("\n");
}

function jsFor(kind, title, subtitle) {
  const head = [
"const app = document.getElementById(\"app\");",
"// This lesson updates the preview panel as you complete each guided block.",
"",
  ];

  const templates = {
    vars: [
"// [STEP:vars-setup:START]",
"const learner = \"FAZ Student\";",
"let completed = 1;",
"const topic = \"Variables\";",
"// [STEP:vars-setup:END]",
"",
"// [STEP:vars-message:START]",
"const message = learner + \" completed \" + completed + \" lesson on \" + topic + \".\";",
"// [STEP:vars-message:END]",
"",
"// [STEP:vars-render:START]",
"app.textContent = message;",
"console.log(message);",
"// [STEP:vars-render:END]",
    ],
    strings: [
"// [STEP:strings-source:START]",
"const rawName = \"  Alex  \";",
"const rawTrack = \"javascript beginner\";",
"// [STEP:strings-source:END]",
"",
"// [STEP:strings-format:START]",
"const name = rawName.trim();",
"const track = rawTrack.trim().toUpperCase();",
"// [STEP:strings-format:END]",
"",
"// [STEP:strings-render:START]",
"app.innerHTML = \"<strong>\" + name + \"</strong> is practicing <em>\" + track + \"</em>.\";",
"// [STEP:strings-render:END]",
    ],
    conditions: [
"// [STEP:conditions-score:START]",
"const score = 78;",
"// [STEP:conditions-score:END]",
"",
"let label = \"Not graded\";",
"// [STEP:conditions-map:START]",
"if (score >= 90) {",
"    label = \"Excellent\";",
"} else if (score >= 70) {",
"    label = \"Great progress\";",
"} else if (score >= 50) {",
"    label = \"Keep practicing\";",
"} else {",
"    label = \"Review basics\";",
"}",
"// [STEP:conditions-map:END]",
"",
"// [STEP:conditions-render:START]",
"app.textContent = \"Score: \" + score + \" • \" + label;",
"// [STEP:conditions-render:END]",
    ],
    functions: [
"// [STEP:functions-create:START]",
"function buildGreeting(name, topic) {",
"    return \"Hi \" + name + \", welcome to \" + topic + \"!\";",
"}",
"// [STEP:functions-create:END]",
"",
"// [STEP:functions-call:START]",
"const lineA = buildGreeting(\"Sam\", \"Functions\");",
"const lineB = buildGreeting(\"Mia\", \"JavaScript basics\");",
"// [STEP:functions-call:END]",
"",
"// [STEP:functions-render:START]",
"app.innerHTML = \"<p>\" + lineA + \"</p><p>\" + lineB + \"</p>\";",
"// [STEP:functions-render:END]",
    ],
    returns: [
"// [STEP:returns-tax:START]",
"function calculateTax(amount, rate) {",
"    return amount * rate;",
"}",
"// [STEP:returns-tax:END]",
"",
"// [STEP:returns-total:START]",
"function calculateTotal(subtotal, rate) {",
"    const tax = calculateTax(subtotal, rate);",
"    return subtotal + tax;",
"}",
"// [STEP:returns-total:END]",
"",
"// [STEP:returns-render:START]",
"const subtotal = 24;",
"const total = calculateTotal(subtotal, 0.08);",
"app.textContent = \"Subtotal $\" + subtotal.toFixed(2) + \" • Total $\" + total.toFixed(2);",
"// [STEP:returns-render:END]",
    ],
    arrays: [
"// [STEP:arrays-create:START]",
"const tasks = [\"Open FAZ IDE\", \"Read lesson\", \"Type code\"];",
"// [STEP:arrays-create:END]",
"",
"// [STEP:arrays-push:START]",
"tasks.push(\"Run preview\");",
"// [STEP:arrays-push:END]",
"",
"// [STEP:arrays-render:START]",
"app.innerHTML = \"<ul>\" + tasks.map(function (task) { return \"<li>\" + task + \"</li>\"; }).join(\"\") + \"</ul>\";",
"// [STEP:arrays-render:END]",
    ],
    map: [
"// [STEP:map-source:START]",
"const scores = [45, 68, 92, 81];",
"// [STEP:map-source:END]",
"",
"// [STEP:map-transform:START]",
"const badges = scores.map(function (score) {",
"    if (score >= 90) return \"Score \" + score + \" => A\";",
"    if (score >= 75) return \"Score \" + score + \" => B\";",
"    if (score >= 60) return \"Score \" + score + \" => C\";",
"    return \"Score \" + score + \" => D\";",
"});",
"// [STEP:map-transform:END]",
"",
"// [STEP:map-render:START]",
"app.innerHTML = badges.map(function (line) { return \"<p>\" + line + \"</p>\"; }).join(\"\");",
"// [STEP:map-render:END]",
    ],
    objects: [
"// [STEP:objects-create:START]",
"const profile = { name: \"Noor\", level: \"Beginner\", focus: \"JavaScript\", streak: 4 };",
"// [STEP:objects-create:END]",
"",
"// [STEP:objects-render:START]",
"const html = [",
"    \"<article>\",",
"    \"<h3>\" + profile.name + \"</h3>\",",
"    \"<p>Level: \" + profile.level + \"</p>\",",
"    \"<p>Focus: \" + profile.focus + \"</p>\",",
"    \"<p>Streak: \" + profile.streak + \" days</p>\",",
"    \"</article>\",",
"].join(\"\");",
"app.innerHTML = html;",
"// [STEP:objects-render:END]",
    ],
    dom: [
"// [STEP:dom-seed:START]",
"app.innerHTML = \"<h3 id=\\\"statusTitle\\\">Session Status</h3><p id=\\\"statusValue\\\">Waiting...</p>\";",
"// [STEP:dom-seed:END]",
"",
"// [STEP:dom-update:START]",
"const titleNode = document.getElementById(\"statusTitle\");",
"const valueNode = document.getElementById(\"statusValue\");",
"titleNode.textContent = \"Session Ready\";",
"valueNode.textContent = \"You can now practice beginner JavaScript lessons.\";",
"// [STEP:dom-update:END]",
    ],
    events: [
"// [STEP:events-seed:START]",
"app.innerHTML = \"<button id=\\\"countBtn\\\" type=\\\"button\\\">Add +1</button><p id=\\\"countValue\\\">Count: 0</p>\";",
"// [STEP:events-seed:END]",
"",
"const countBtn = document.getElementById(\"countBtn\");",
"const countValue = document.getElementById(\"countValue\");",
"let count = 0;",
"",
"// [STEP:events-wire:START]",
"countBtn.addEventListener(\"click\", function () {",
"    count += 1;",
"    countValue.textContent = \"Count: \" + count;",
"});",
"// [STEP:events-wire:END]",
    ],
    input: [
"// [STEP:input-seed:START]",
"app.innerHTML = \"<label for=\\\"nameInput\\\">Your Name</label><input id=\\\"nameInput\\\" type=\\\"text\\\" placeholder=\\\"Type your name\\\" /><p id=\\\"namePreview\\\">Preview: --</p>\";",
"// [STEP:input-seed:END]",
"",
"const nameInput = document.getElementById(\"nameInput\");",
"const namePreview = document.getElementById(\"namePreview\");",
"",
"// [STEP:input-wire:START]",
"nameInput.addEventListener(\"input\", function () {",
"    const value = nameInput.value.trim();",
"    namePreview.textContent = \"Preview: \" + (value || \"--\");",
"});",
"// [STEP:input-wire:END]",
    ],
    filter: [
"const topics = [\"Variables\", \"Functions\", \"Arrays\", \"Objects\", \"DOM\", \"Events\"];",
"",
"// [STEP:filter-seed:START]",
"app.innerHTML = \"<input id=\\\"searchInput\\\" type=\\\"text\\\" placeholder=\\\"Search topics\\\" /><ul id=\\\"topicList\\\"></ul>\";",
"// [STEP:filter-seed:END]",
"",
"const searchInput = document.getElementById(\"searchInput\");",
"const topicList = document.getElementById(\"topicList\");",
"",
"function renderTopicList(list) {",
"    topicList.innerHTML = list.map(function (item) { return \"<li>\" + item + \"</li>\"; }).join(\"\");",
"}",
"renderTopicList(topics);",
"",
"// [STEP:filter-wire:START]",
"searchInput.addEventListener(\"input\", function () {",
"    const query = searchInput.value.trim().toLowerCase();",
"    const filtered = topics.filter(function (item) { return item.toLowerCase().includes(query); });",
"    renderTopicList(filtered);",
"});",
"// [STEP:filter-wire:END]",
    ],
    timer: [
"// [STEP:timer-seed:START]",
"app.innerHTML = \"<div style=\\\"display:flex;gap:8px;\\\"><button id=\\\"startBtn\\\" type=\\\"button\\\">Start</button><button id=\\\"stopBtn\\\" type=\\\"button\\\">Stop</button></div><p id=\\\"timerLabel\\\">Seconds: 0</p>\";",
"// [STEP:timer-seed:END]",
"",
"const startBtn = document.getElementById(\"startBtn\");",
"const stopBtn = document.getElementById(\"stopBtn\");",
"const timerLabel = document.getElementById(\"timerLabel\");",
"let seconds = 0;",
"let timerId = 0;",
"",
"// [STEP:timer-wire:START]",
"startBtn.addEventListener(\"click\", function () {",
"    if (timerId) return;",
"    timerId = window.setInterval(function () {",
"        seconds += 1;",
"        timerLabel.textContent = \"Seconds: \" + seconds;",
"    }, 1000);",
"});",
"",
"stopBtn.addEventListener(\"click\", function () {",
"    if (!timerId) return;",
"    window.clearInterval(timerId);",
"    timerId = 0;",
"});",
"// [STEP:timer-wire:END]",
    ],
    random: [
"const quotes = [",
"    \"Small steps build strong skills.\",",
"    \"Practice turns confusion into confidence.\",",
"    \"Debugging is learning in slow motion.\",",
"    \"Consistency beats intensity.\",",
"];",
"",
"// [STEP:random-seed:START]",
"app.innerHTML = \"<button id=\\\"quoteBtn\\\" type=\\\"button\\\">New Quote</button><p id=\\\"quoteText\\\">Click the button to load a quote.</p>\";",
"// [STEP:random-seed:END]",
"",
"const quoteBtn = document.getElementById(\"quoteBtn\");",
"const quoteText = document.getElementById(\"quoteText\");",
"",
"// [STEP:random-wire:START]",
"quoteBtn.addEventListener(\"click\", function () {",
"    const index = Math.floor(Math.random() * quotes.length);",
"    quoteText.textContent = quotes[index];",
"});",
"// [STEP:random-wire:END]",
    ],
    toggle: [
"// [STEP:toggle-seed:START]",
"app.innerHTML = \"<button id=\\\"modeBtn\\\" type=\\\"button\\\">Enable Focus Mode</button><p id=\\\"modeText\\\" data-focus=\\\"false\\\">Focus mode: OFF</p>\";",
"// [STEP:toggle-seed:END]",
"",
"const modeBtn = document.getElementById(\"modeBtn\");",
"const modeText = document.getElementById(\"modeText\");",
"let focusMode = false;",
"",
"// [STEP:toggle-wire:START]",
"modeBtn.addEventListener(\"click\", function () {",
"    focusMode = !focusMode;",
"    modeText.dataset.focus = String(focusMode);",
"    modeText.textContent = \"Focus mode: \" + (focusMode ? \"ON\" : \"OFF\");",
"    modeBtn.textContent = focusMode ? \"Disable Focus Mode\" : \"Enable Focus Mode\";",
"});",
"// [STEP:toggle-wire:END]",
    ],
    calc: [
"// [STEP:calc-seed:START]",
"app.innerHTML = \"<div style=\\\"display:grid;gap:8px;max-width:280px;\\\"><input id=\\\"numA\\\" type=\\\"number\\\" value=\\\"2\\\" /><input id=\\\"numB\\\" type=\\\"number\\\" value=\\\"3\\\" /><button id=\\\"calcBtn\\\" type=\\\"button\\\">Calculate</button></div><p id=\\\"calcOut\\\">Result: --</p>\";",
"// [STEP:calc-seed:END]",
"",
"const numA = document.getElementById(\"numA\");",
"const numB = document.getElementById(\"numB\");",
"const calcBtn = document.getElementById(\"calcBtn\");",
"const calcOut = document.getElementById(\"calcOut\");",
"",
"// [STEP:calc-wire:START]",
"calcBtn.addEventListener(\"click\", function () {",
"    const a = Number(numA.value || 0);",
"    const b = Number(numB.value || 0);",
"    calcOut.textContent = \"Sum: \" + (a + b) + \" • Product: \" + (a * b);",
"});",
"// [STEP:calc-wire:END]",
    ],
    score: [
"// [STEP:score-seed:START]",
"app.innerHTML = \"<p id=\\\"board\\\">Home 0 : 0 Away</p><div style=\\\"display:flex;gap:8px;flex-wrap:wrap;\\\"><button id=\\\"homeBtn\\\" type=\\\"button\\\">Home +1</button><button id=\\\"awayBtn\\\" type=\\\"button\\\">Away +1</button><button id=\\\"resetBtn\\\" type=\\\"button\\\">Reset</button></div>\";",
"// [STEP:score-seed:END]",
"",
"const board = document.getElementById(\"board\");",
"const homeBtn = document.getElementById(\"homeBtn\");",
"const awayBtn = document.getElementById(\"awayBtn\");",
"const resetBtn = document.getElementById(\"resetBtn\");",
"",
"// [STEP:score-state:START]",
"const score = { home: 0, away: 0 };",
"function renderScoreboard() {",
"    board.textContent = \"Home \" + score.home + \" : \" + score.away + \" Away\";",
"}",
"renderScoreboard();",
"// [STEP:score-state:END]",
"",
"// [STEP:score-wire:START]",
"homeBtn.addEventListener(\"click\", function () { score.home += 1; renderScoreboard(); });",
"awayBtn.addEventListener(\"click\", function () { score.away += 1; renderScoreboard(); });",
"resetBtn.addEventListener(\"click\", function () { score.home = 0; score.away = 0; renderScoreboard(); });",
"// [STEP:score-wire:END]",
    ],
  };

  const body = templates[kind] || templates.vars;
  const source = head.concat(body, ["", `// ${title}`, `// ${subtitle}`, ""]).join("\n");
  return source
    .replace(/\/\/ \[STEP:([A-Za-z0-9._-]+):START\]/g, (_full, id) => {
      const label = String(id || "step").replace(/[-_.]+/g, " ");
      return `// This section focuses on ${label}. [LESSON:${id}]`;
    })
    .replace(/^.*\[STEP:([A-Za-z0-9._-]+):END\].*\n?/gm, "");
}

for (const [id, title, subtitle, checklist, kind] of lessons) {
  const dir = path.join(lessonsRoot, id);
  fs.mkdirSync(dir, { recursive: true });
  fs.writeFileSync(path.join(dir, "styles.css"), css, "utf8");
  fs.writeFileSync(path.join(dir, "index.html"), html(title, subtitle, checklist, lessonGoals[kind]), "utf8");
  fs.writeFileSync(path.join(dir, "app.js"), jsFor(kind, title, subtitle), "utf8");
}

console.log(`Generated ${lessons.length} detailed beginner lessons.`);
