/* assets/css/components.css
   FAZ IDE (v0) - components:
   - status chip
   - buttons
   - editor textarea
   - output log
   - hints and kbd pills
*/

.status {
    display: inline-flex;
    align-items: center;
    gap: var(--space-7);
    padding: 0;
    border: 0;
    border-radius: var(--radius-sm);
    background: transparent;
    box-shadow: none;
    color: var(--text-muted-soft);
    font-size: var(--text-size-xs);
    font-weight: 500;
    min-width: 0;
    max-width: none;
}

#statusText {
    display: block;
    min-width: 0;
    overflow: visible;
    text-overflow: clip;
    white-space: nowrap;
    line-height: 1.2;
}

.health {
    display: flex;
    flex-wrap: nowrap;
    gap: var(--space-6);
    justify-content: flex-end;
    min-width: 0;
}

.top .strip-right .health {
    margin-left: auto;
    flex: 0 0 auto;
}

.top .strip-right .status {
    margin-left: 0;
    margin-right: 0;
    flex: 0 0 auto;
}

.dot {
    width: var(--space-8);
    height: var(--space-8);
    border-radius: 0;
    background: var(--accent);
    box-shadow:
        0 0 0 2px var(--status-dot-ring),
        0 0 10px var(--status-dot-glow);
    transform-origin: center;
    animation: status-dot-pulse 2.2s ease-in-out infinite;
}

@keyframes status-dot-pulse {
    0%,
    100% {
        transform: scale(1);
        box-shadow:
            0 0 0 2px var(--status-dot-ring),
            0 0 10px var(--status-dot-glow);
    }
    50% {
        transform: scale(1.18);
        box-shadow:
            0 0 0 6px var(--status-dot-ring-pulse),
            0 0 14px var(--status-dot-glow-pulse);
    }
}

@media (prefers-reduced-motion: reduce) {
    .dot {
        animation: none;
    }
}

button {
    appearance: none;
    border: 1px solid var(--btn-border);
    background: var(--btn-bg);
    color: var(--text);
    padding: var(--space-8) var(--space-12);
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-weight: 600;
    font-size: var(--text-size-xs);
    letter-spacing: var(--letter-spacing-tight);
    min-height: var(--control-height-lg);
    line-height: 1;
    transition:
        border-color var(--motion-base) var(--motion-ease),
        background var(--motion-base) var(--motion-ease),
        box-shadow var(--motion-base) var(--motion-ease),
        transform var(--motion-fast) var(--motion-ease);
}

button:hover {
    border-color: var(--btn-border-hover);
    background: var(--btn-bg-hover);
}

button:active { transform: translateY(var(--space-1)); }

button:disabled {
    opacity: 0.55;
    cursor: not-allowed;
    box-shadow: none;
}

button.primary {
    border-color: var(--btn-primary-border);
    background: var(--btn-primary-bg);
    box-shadow: inset 0 0 0 1px var(--btn-primary-shadow);
}

button[data-active="true"] {
    border-color: var(--btn-active-border);
    background: var(--btn-active-bg);
    box-shadow: inset 0 0 0 1px var(--btn-active-shadow);
}

button[aria-pressed="true"] {
    border-color: var(--btn-pressed-border);
    color: var(--btn-pressed-text);
    box-shadow: inset 0 0 0 1px var(--btn-pressed-shadow);
}

#layoutToggle[aria-expanded="true"] {
    border-color: var(--btn-pressed-border);
    color: var(--btn-pressed-text);
    box-shadow: inset 0 0 0 1px var(--btn-pressed-shadow);
}

button.danger {
    border-color: var(--btn-danger-border);
    background: var(--btn-danger-bg);
}

button:focus-visible {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 2px var(--ring-focus);
}

.top.strip button {
    padding: var(--space-4) var(--space-9);
    font-size: var(--text-size-xs);
    min-height: var(--control-height-sm);
    background: transparent;
    border-color: transparent;
    box-shadow: none;
    color: var(--text-top-control);
    font-weight: 500;
    text-decoration-line: none;
    text-decoration-thickness: 1.25px;
    text-underline-offset: 0.16em;
}

.top.strip button:hover {
    background: var(--surface-top-hover);
    border-color: var(--border-top-hover);
}

.top.strip button:active {
    transform: none;
    background: var(--surface-top-active);
}

.top.strip button:focus-visible {
    border-color: var(--border-focus-soft);
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

.top.strip button[data-panel-toggle="true"][data-panel-open="false"] {
    color: var(--text-muted-soft);
    text-decoration-line: line-through;
    text-decoration-color: var(--text-muted-soft);
    border-color: transparent;
    background: transparent;
}

.top.strip button[data-panel-toggle="true"][data-panel-open="false"]:hover {
    background: transparent;
    border-color: transparent;
}

.top-theme-select {
    position: relative;
    z-index: 1;
    display: block;
    width: 100%;
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    min-width: 0;
    margin: 0;
    border: 1px solid transparent;
    border-radius: var(--radius-sm);
    background-color: var(--surface-panel);
    color: var(--text-top-control);
    font-family: var(--font);
    font-size: var(--text-size-xs);
    font-weight: 600;
    letter-spacing: var(--letter-spacing-ui-plus);
    line-height: var(--control-height-sm);
    appearance: none;
    cursor: pointer;
    box-sizing: border-box;
    padding: 0 var(--space-22) 0 var(--space-8);
    background-image:
        linear-gradient(45deg, transparent 50%, var(--files-caret-color) 50%),
        linear-gradient(135deg, var(--files-caret-color) 50%, transparent 50%);
    background-position:
        calc(100% - var(--space-12)) calc(50% - var(--space-1)),
        calc(100% - var(--space-8)) calc(50% - var(--space-1));
    background-size: var(--space-4) var(--space-4), var(--space-4) var(--space-4);
    background-repeat: no-repeat;
    color-scheme: inherit;
    transform: translateY(0);
    transition:
        background-color var(--motion-base) var(--motion-ease),
        border-color var(--motion-base) var(--motion-ease),
        box-shadow var(--motion-base) var(--motion-ease),
        transform var(--motion-fast) var(--motion-ease),
        background-position var(--motion-fast) var(--motion-ease);
}

.strip-theme-group {
    position: relative;
    display: inline-flex;
    align-items: center;
    flex: 0 0 auto;
    width: var(--top-theme-width);
    min-width: var(--top-theme-width);
    min-height: var(--control-height-sm);
    overflow: visible;
}

.top-theme-select:hover {
    background-color: var(--surface-top-hover);
    border-color: var(--border-top-hover);
}

.top-theme-select:focus-visible {
    outline: none;
    border-color: var(--border-focus-soft);
    box-shadow: 0 0 0 var(--ring-size-md) var(--ring-focus-soft);
    transform: translateY(calc(var(--space-1) * -1));
    background-position:
        calc(100% - var(--space-12)) calc(50% + var(--space-1)),
        calc(100% - var(--space-8)) calc(50% + var(--space-1));
    animation: theme-select-pulse var(--motion-ui) var(--motion-ease);
}

.top-theme-select:active {
    transform: translateY(0);
    box-shadow: 0 0 0 var(--ring-size-sm) var(--ring-focus-soft);
    background-position:
        calc(100% - var(--space-12)) calc(50% + var(--space-2)),
        calc(100% - var(--space-8)) calc(50% + var(--space-2));
}

@keyframes theme-select-pulse {
    0% {
        box-shadow: 0 0 0 0 var(--theme-select-pulse-start);
    }
    100% {
        box-shadow: 0 0 0 var(--ring-size-md) var(--theme-select-pulse-end);
    }
}

@media (prefers-reduced-motion: reduce) {
    .top-theme-select {
        transition: none;
    }

    .top-theme-select:focus-visible {
        animation: none;
        transform: none;
    }

    .top-theme-select:active {
        transform: none;
    }
}

.top-theme-select option {
    background-color: var(--surface-panel);
    color: var(--text);
}

.top-theme-select option:checked {
    background-color: var(--surface-selected);
    color: var(--text-accent-strong);
}

.strip-command-group {
    width: 100%;
    max-width: 100%;
    min-width: min(320px, 100%);
}

@supports (width: 20cqw) {
    .strip-command-group {
        width: clamp(320px, 20cqw, 960px);
    }
}

.top-command-input {
    width: 100%;
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-top-hover);
    background: var(--surface-command);
    color: var(--text);
    padding: 0 var(--space-12);
    font-size: var(--text-size-xs);
    line-height: var(--control-height-sm);
}

.top-command-input::placeholder {
    color: var(--text-muted-quiet);
}

.top-command-input:hover {
    border-color: var(--border-strong);
}

.top-command-input:focus-visible {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 2px var(--ring-focus);
}

.top-command-dropdown {
    position: fixed;
    top: 0;
    left: 0;
    width: min(680px, calc(100vw - 16px));
    display: none;
    flex-direction: column;
    gap: var(--space-6);
    padding: var(--space-8);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--modal-surface);
    box-shadow: var(--modal-shadow);
    z-index: 1600;
}

.CodeMirror .cm-lesson-active {
    background: var(--surface-selected-soft);
    color: var(--text);
}

.CodeMirror .cm-lesson-ghost {
    color: var(--text-muted-quiet);
    opacity: 0.18;
}

.CodeMirror .cm-lesson-next {
    color: var(--text);
    background: color-mix(in srgb, var(--surface-selected-soft) 55%, transparent);
    border-bottom: 1px solid var(--border-focus-strong);
    animation: lesson-next-blink 1s steps(1, end) infinite;
}

@keyframes lesson-next-blink {
    0%,
    49% {
        opacity: 1;
    }
    50%,
    100% {
        opacity: 0.35;
    }
}

@media (prefers-reduced-motion: reduce) {
    .CodeMirror .cm-lesson-next {
        animation: none;
        opacity: 1;
    }
}

.top-command-dropdown[data-open="true"] {
    display: flex;
}

#topCommandPaletteList {
    max-height: min(46vh, 320px);
}

#topCommandPaletteHint {
    margin: 0;
    padding: 0 var(--space-2);
}

.title-row {
    display: flex;
    align-items: center;
    gap: var(--space-8);
    min-height: var(--panel-header-content-height, 32px);
}

.editor-panel .title-row {
    justify-content: center;
}

.drag-handle {
    width: var(--control-size-md);
    min-width: var(--control-size-md);
    max-width: var(--control-size-md);
    height: var(--control-size-md);
    min-height: var(--control-size-md);
    max-height: var(--control-size-md);
    flex: 0 0 var(--control-size-md);
    aspect-ratio: 1 / 1;
    padding: 0;
    border-radius: var(--radius-sm);
    box-sizing: border-box;
    font-size: 0;
    line-height: 1;
    letter-spacing: 0;
    cursor: grab;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: transparent;
    background: var(--drag-handle-bg);
    touch-action: none;
    position: relative;
    overflow: hidden;
}

.drag-handle::before {
    content: "+";
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    color: var(--drag-handle-glyph);
    font-size: var(--text-size-base);
    line-height: 1;
    font-weight: 700;
    font-family: var(--font);
}

.drag-handle:active {
    cursor: grabbing;
}

.toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-10);
    align-items: center;
    justify-content: flex-end;
    margin-left: auto;
}

#editor {
    --editor-surface: var(--surface-menu);
    --editor-gutter-surface: var(--surface-menu);
    width: 100%;
    min-height: 0;
    height: 100%;
    flex: 1;
    resize: none;
    padding: var(--space-12);
    box-sizing: border-box;

    border-radius: var(--radius-sm);
    border: 1px solid var(--border);

    background: var(--editor-surface);
    color: var(--text);
    outline: none;

    font-family: var(--editor-font-family, var(--mono));
    font-size: var(--text-size-xs);
    line-height: 1.55;
    tab-size: 2;
    scrollbar-gutter: stable both-edges;
    overflow-anchor: none;
    text-rendering: optimizeLegibility;
    font-kerning: normal;
    font-variant-ligatures: none;
    -webkit-font-smoothing: antialiased;
    caret-color: var(--syntax-cursor);
}

#editor:focus {
    border-color: var(--editor-focus-border);
    box-shadow: 0 0 0 3px var(--editor-focus-ring);
}

.CodeMirror {
    --editor-surface: var(--surface-menu);
    --editor-gutter-surface: var(--surface-menu);
    height: 100%;
    min-height: 0;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--editor-surface);
    font-family: var(--editor-font-family, var(--mono));
    font-size: var(--text-size-xs);
    line-height: 1.55;
    flex: 1;
    padding: 0;
    box-sizing: border-box;
    overflow: hidden;
    text-rendering: optimizeLegibility;
    font-kerning: normal;
    font-variant-ligatures: none;
    -webkit-font-smoothing: antialiased;
}

.CodeMirror.cm-s-default,
.CodeMirror.cm-s-material-darker {
    background: var(--editor-surface) !important;
    color: var(--syntax-plain) !important;
}

.CodeMirror.cm-s-default .CodeMirror-scroll,
.CodeMirror.cm-s-material-darker .CodeMirror-scroll {
    background: var(--editor-surface) !important;
}

.CodeMirror.cm-s-default .CodeMirror-gutters,
.CodeMirror.cm-s-material-darker .CodeMirror-gutters {
    background: var(--editor-gutter-surface) !important;
    border-right: 1px solid var(--border) !important;
}

.CodeMirror.cm-s-default .CodeMirror-linenumber,
.CodeMirror.cm-s-material-darker .CodeMirror-linenumber {
    color: var(--syntax-line-number) !important;
}

.CodeMirror.cm-s-default .CodeMirror-activeline .CodeMirror-linenumber,
.CodeMirror.cm-s-material-darker .CodeMirror-activeline .CodeMirror-linenumber {
    color: var(--syntax-line-number-active) !important;
}

.CodeMirror.cm-s-default .CodeMirror-cursor,
.CodeMirror.cm-s-material-darker .CodeMirror-cursor {
    border-left-color: var(--syntax-cursor) !important;
}

.CodeMirror.cm-s-default .CodeMirror-activeline-background,
.CodeMirror.cm-s-material-darker .CodeMirror-activeline-background {
    background: var(--syntax-active-line-bg) !important;
}

.CodeMirror.cm-s-default .cm-keyword,
.CodeMirror.cm-s-material-darker .cm-keyword { color: var(--syntax-keyword) !important; }
.CodeMirror.cm-s-default .cm-atom,
.CodeMirror.cm-s-material-darker .cm-atom { color: var(--syntax-atom) !important; }
.CodeMirror.cm-s-default .cm-number,
.CodeMirror.cm-s-material-darker .cm-number { color: var(--syntax-number) !important; }
.CodeMirror.cm-s-default .cm-def,
.CodeMirror.cm-s-material-darker .cm-def { color: var(--syntax-def) !important; }
.CodeMirror.cm-s-default .cm-variable,
.CodeMirror.cm-s-material-darker .cm-variable { color: var(--syntax-variable) !important; }
.CodeMirror.cm-s-default .cm-variable-2,
.CodeMirror.cm-s-material-darker .cm-variable-2 { color: var(--syntax-variable-2) !important; }
.CodeMirror.cm-s-default .cm-variable-3,
.CodeMirror.cm-s-material-darker .cm-variable-3 { color: var(--syntax-variable-3) !important; }
.CodeMirror.cm-s-default .cm-property,
.CodeMirror.cm-s-material-darker .cm-property { color: var(--syntax-property) !important; }
.CodeMirror.cm-s-default .cm-operator,
.CodeMirror.cm-s-material-darker .cm-operator { color: var(--syntax-operator) !important; }
.CodeMirror.cm-s-default .cm-comment,
.CodeMirror.cm-s-material-darker .cm-comment { color: var(--syntax-comment) !important; }
.CodeMirror.cm-s-default .cm-string,
.CodeMirror.cm-s-material-darker .cm-string { color: var(--syntax-string) !important; }
.CodeMirror.cm-s-default .cm-string-2,
.CodeMirror.cm-s-material-darker .cm-string-2 { color: var(--syntax-string-2) !important; }
.CodeMirror.cm-s-default .cm-meta,
.CodeMirror.cm-s-material-darker .cm-meta { color: var(--syntax-meta) !important; }
.CodeMirror.cm-s-default .cm-tag,
.CodeMirror.cm-s-material-darker .cm-tag { color: var(--syntax-tag) !important; }
.CodeMirror.cm-s-default .cm-attribute,
.CodeMirror.cm-s-material-darker .cm-attribute { color: var(--syntax-attribute) !important; }
.CodeMirror.cm-s-default .cm-qualifier,
.CodeMirror.cm-s-material-darker .cm-qualifier { color: var(--syntax-qualifier) !important; }
.CodeMirror.cm-s-default .cm-builtin,
.CodeMirror.cm-s-material-darker .cm-builtin { color: var(--syntax-builtin) !important; }
.CodeMirror.cm-s-default .cm-bracket,
.CodeMirror.cm-s-material-darker .cm-bracket { color: var(--syntax-bracket) !important; }

.CodeMirror.cm-s-default .CodeMirror-matchingbracket,
.CodeMirror.cm-s-material-darker .CodeMirror-matchingbracket {
    color: var(--syntax-bracket) !important;
    background: var(--syntax-matching-bracket-bg) !important;
    box-shadow: inset 0 0 0 1px var(--syntax-matching-bracket-border) !important;
}

.CodeMirror.cm-s-default .CodeMirror-nonmatchingbracket,
.CodeMirror.cm-s-material-darker .CodeMirror-nonmatchingbracket {
    color: var(--syntax-bracket) !important;
    background: var(--syntax-nonmatching-bracket-bg) !important;
    box-shadow: inset 0 0 0 1px var(--syntax-nonmatching-bracket-border) !important;
}

.CodeMirror-scroll {
    background: var(--editor-surface);
    scrollbar-gutter: stable both-edges;
    overflow-anchor: none;
    text-rendering: optimizeLegibility;
}

.CodeMirror-selected {
    background: var(--syntax-selection-bg) !important;
}

.CodeMirror-focused .CodeMirror-selected {
    background: var(--syntax-selection-bg-focus) !important;
}

.CodeMirror ::selection,
.CodeMirror-line ::selection,
.CodeMirror-line>span::selection,
.CodeMirror-line>span>span::selection {
    background: var(--syntax-selection-bg-focus);
}

.CodeMirror ::-moz-selection,
.CodeMirror-line ::-moz-selection,
.CodeMirror-line>span::-moz-selection,
.CodeMirror-line>span>span::-moz-selection {
    background: var(--syntax-selection-bg-focus);
}

#editor::-webkit-scrollbar-corner,
.editor-panel .CodeMirror-scroll::-webkit-scrollbar-corner {
    background: var(--editor-surface);
}

.cm-inline-error {
    text-decoration-line: underline;
    text-decoration-style: wavy;
    text-decoration-color: var(--diagnostic-error);
    text-decoration-thickness: 1.2px;
}

.cm-inline-warn {
    text-decoration-line: underline;
    text-decoration-style: wavy;
    text-decoration-color: var(--diagnostic-warn);
    text-decoration-thickness: 1.2px;
}

.cm-inline-info {
    text-decoration-line: underline;
    text-decoration-style: wavy;
    text-decoration-color: var(--diagnostic-info);
    text-decoration-thickness: 1.2px;
}

.cm-error-lens {
    margin: var(--space-3) 0 var(--space-1);
    padding: var(--space-3) var(--space-8);
    border-radius: var(--radius-sm);
    border: 1px solid var(--diagnostic-lens-border);
    background: var(--diagnostic-lens-bg);
    color: var(--diagnostic-lens-text);
    font-size: var(--text-size-2xs);
    line-height: 1.35;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.cm-error-lens[data-level="error"] {
    border-color: var(--diagnostic-lens-error-border);
    background: var(--diagnostic-lens-error-bg);
    color: var(--diagnostic-lens-error-text);
}

.cm-error-lens[data-level="warn"] {
    border-color: var(--diagnostic-lens-warn-border);
    background: var(--diagnostic-lens-warn-bg);
    color: var(--diagnostic-lens-warn-text);
}

.cm-error-lens[data-level="info"] {
    border-color: var(--diagnostic-lens-info-border);
    background: var(--diagnostic-lens-info-bg);
    color: var(--diagnostic-lens-info-text);
}

.hint {
    margin: var(--space-10) 0 0;
    color: var(--muted);
    font-size: var(--text-size-xs);
}

.kbd {
    display: inline-block;
    padding: var(--space-2) var(--space-6);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--kbd-bg);
    color: var(--text);
    font-family: var(--font);
    font-size: var(--text-size-2xs);
}

.editor-header {
    display: grid;
    grid-template-columns: auto auto auto minmax(0, 1fr);
    align-items: center;
    gap: var(--space-8);
    justify-content: start;
    width: max-content;
    min-width: 100%;
    height: var(--panel-header-content-height, 32px);
    min-height: var(--panel-header-content-height, 32px);
    overflow-x: auto;
    overflow-y: hidden;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb-hover) transparent;
    -ms-overflow-style: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
}

.editor-header::-webkit-scrollbar {
    height: var(--scrollbar-size);
}

.editor-header::-webkit-scrollbar-track {
    background: transparent;
}

.editor-header::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
}

.editor-header::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
}

.editor-title {
    margin: 0;
    font-size: var(--panel-title-size, 13px);
    line-height: 1;
    font-weight: 700;
    justify-self: start;
    text-align: left;
    white-space: nowrap;
    text-transform: none;
    letter-spacing: 0.18px;
    color: var(--text-top-control);
}

.top-lesson-stats {
    display: inline-flex;
    align-items: center;
    gap: var(--space-5);
    padding-left: var(--space-8);
    border-left: 1px solid var(--border-soft);
    justify-content: flex-end;
    white-space: nowrap;
}

.top-lesson-stat {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    padding: var(--space-4) var(--space-9);
    font-size: var(--text-size-xs);
    border: 1px solid transparent;
    background: transparent;
    box-shadow: none;
    color: var(--text-top-control);
    font-weight: 500;
    text-decoration-line: none;
    text-decoration-thickness: 1.25px;
    text-underline-offset: 0.16em;
    border-radius: var(--radius-sm);
    line-height: 1;
    pointer-events: none;
}

.lesson-hud {
    position: absolute;
    top: var(--lesson-hud-offset);
    right: var(--lesson-hud-offset);
    bottom: var(--lesson-hud-offset);
    z-index: 8;
    display: flex;
    align-items: stretch;
    justify-content: center;
    width: var(--lesson-hud-width);
    min-height: 0;
    height: auto;
    padding: 0;
    border: 1px solid var(--border-soft);
    border-radius: var(--radius-sm);
    background: color-mix(in srgb, var(--surface-panel) 68%, transparent);
    box-shadow:
        inset 0 0 0 1px color-mix(in srgb, var(--surface-raised) 16%, transparent),
        0 4px 12px color-mix(in srgb, var(--surface-bg) 52%, transparent);
    backdrop-filter: blur(7px) saturate(1.14);
    pointer-events: none;
    --lesson-progress: 0%;
    --lesson-hud-chip-font-size: clamp(11px, 0.72rem, 12px);
}

.lesson-hud[data-active="false"] {
    display: none;
}

.lesson-hud::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(
        180deg,
        color-mix(in srgb, var(--surface-selected-soft) 22%, transparent),
        transparent 72%
    );
    opacity: 0.4;
    border-radius: inherit;
    pointer-events: none;
}

.lesson-hud::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    border: 1px solid color-mix(in srgb, var(--text-top-control) 8%, transparent);
    pointer-events: none;
}

.lesson-hud-chip {
    display: inline-flex;
    position: relative;
    align-items: center;
    min-height: 21px;
    padding: 0 var(--space-7);
    border: 1px solid var(--border-soft);
    border-radius: var(--radius-xxs);
    background: linear-gradient(
        180deg,
        color-mix(in srgb, var(--surface-panel) 92%, transparent),
        color-mix(in srgb, var(--surface-raised) 86%, transparent)
    );
    color: var(--text-muted-soft);
    font-size: var(--lesson-hud-chip-font-size);
    font-family: var(--font);
    line-height: 1.22;
    letter-spacing: 0;
    -webkit-font-smoothing: antialiased;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
}

.lesson-hud-chip::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(
        180deg,
        color-mix(in srgb, var(--text-top-control) 7%, transparent),
        transparent 55%
    );
    pointer-events: none;
}

.lesson-hud-chip-step {
    max-width: 180px;
    font-weight: 600;
    border-color: color-mix(in srgb, var(--border-focus-soft) 56%, var(--border-soft) 44%);
    background: linear-gradient(
        180deg,
        color-mix(in srgb, var(--surface-selected-soft) 14%, var(--surface-panel) 86%),
        color-mix(in srgb, var(--surface-panel) 90%, transparent)
    );
}

.lesson-hud-legacy {
    display: none;
}

.lesson-hud-rail {
    position: relative;
    border: 0;
    border-radius: calc(var(--radius-sm) - 1px);
    background: color-mix(in srgb, var(--surface-raised) 62%, transparent);
    overflow: hidden;
    width: 100%;
    height: 100%;
}

.lesson-hud-rail-vertical {
    width: 100%;
    height: 100%;
    min-height: 0;
}

.lesson-hud-rail-bottom {
    display: none;
}

.lesson-hud-fill {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: var(--lesson-progress, 0%);
    border-radius: inherit;
    background: linear-gradient(
        180deg,
        color-mix(in srgb, var(--surface-selected-soft) 72%, transparent),
        color-mix(in srgb, var(--text-top-control) 90%, transparent)
    );
    box-shadow:
        0 0 8px color-mix(in srgb, var(--text-top-control) 30%, transparent),
        inset 0 0 0 1px color-mix(in srgb, var(--text-top-control) 22%, transparent);
    transition: height 140ms linear, filter var(--motion-ui) var(--motion-ease);
}

.lesson-hud-streak-fill {
    position: absolute;
    inset: 0 auto 0 0;
    width: var(--lesson-combo-progress, 0%);
    border-radius: inherit;
    background: linear-gradient(
        90deg,
        color-mix(in srgb, var(--surface-selected-soft) 64%, transparent),
        color-mix(in srgb, var(--text-top-control) 88%, transparent)
    );
    transition: width var(--motion-ui) var(--motion-ease);
}

.lesson-hud-fill::after,
.lesson-hud-streak-fill::after {
    content: "";
    position: absolute;
    inset: 0;
    left: -38%;
    width: 38%;
    background: linear-gradient(
        90deg,
        transparent,
        color-mix(in srgb, var(--text-top-control) 30%, transparent),
        transparent
    );
    opacity: 0;
    transform: skewX(-14deg);
    pointer-events: none;
}

.lesson-hud[data-streak-tier="warm"] .lesson-hud-fill,
.lesson-hud[data-streak-tier="hot"] .lesson-hud-fill,
.lesson-hud[data-streak-tier="fire"] .lesson-hud-fill,
.lesson-hud[data-streak-tier="warm"] .lesson-hud-streak-fill,
.lesson-hud[data-streak-tier="hot"] .lesson-hud-streak-fill,
.lesson-hud[data-streak-tier="fire"] .lesson-hud-streak-fill {
    animation: lesson-hud-energy 1.6s ease-in-out infinite alternate;
}

.lesson-hud[data-streak-tier="warm"] .lesson-hud-fill::after,
.lesson-hud[data-streak-tier="hot"] .lesson-hud-fill::after,
.lesson-hud[data-streak-tier="fire"] .lesson-hud-fill::after,
.lesson-hud[data-streak-tier="warm"] .lesson-hud-streak-fill::after,
.lesson-hud[data-streak-tier="hot"] .lesson-hud-streak-fill::after,
.lesson-hud[data-streak-tier="fire"] .lesson-hud-streak-fill::after {
    opacity: 0.44;
    animation: lesson-hud-fill-sweep 2.2s ease-in-out infinite;
}

.lesson-hud[data-streak-tier="warm"] .lesson-hud-chip-step,
.lesson-hud[data-streak-tier="warm"] .lesson-header-chip {
    border-color: color-mix(in srgb, var(--border-focus-soft) 65%, var(--border-soft) 35%);
}

.lesson-hud[data-streak-tier="hot"] .lesson-hud-chip-step,
.lesson-hud[data-streak-tier="fire"] .lesson-hud-chip-step,
.lesson-hud[data-streak-tier="hot"] .lesson-header-chip,
.lesson-hud[data-streak-tier="fire"] .lesson-header-chip {
    border-color: color-mix(in srgb, var(--border-focus-strong) 70%, var(--border-soft) 30%);
}

.lesson-hud[data-streak-tier="hot"] {
    box-shadow:
        0 0 0 1px color-mix(in srgb, var(--surface-raised) 18%, transparent),
        0 0 0 3px color-mix(in srgb, var(--surface-selected-soft) 32%, transparent),
        0 12px 22px color-mix(in srgb, var(--surface-bg) 68%, transparent);
}

.lesson-hud[data-streak-tier="fire"] {
    box-shadow:
        0 0 0 1px color-mix(in srgb, var(--surface-raised) 22%, transparent),
        0 0 0 4px color-mix(in srgb, var(--surface-selected-soft) 40%, transparent),
        0 14px 24px color-mix(in srgb, var(--surface-bg) 70%, transparent);
}

.lesson-hud[data-streak-tier="warm"] .lesson-hud-mood,
.lesson-hud[data-streak-tier="hot"] .lesson-hud-mood,
.lesson-hud[data-streak-tier="fire"] .lesson-hud-mood {
    color: var(--text-top-control);
}

.lesson-hud[data-mood="perfect"] .lesson-hud-fill {
    background: linear-gradient(
        180deg,
        color-mix(in srgb, var(--surface-selected-soft) 42%, transparent),
        color-mix(in srgb, var(--text) 92%, transparent)
    );
}

.lesson-hud[data-mood="perfect"] .lesson-hud-streak-fill {
    background: linear-gradient(
        90deg,
        color-mix(in srgb, var(--surface-selected-soft) 58%, transparent),
        color-mix(in srgb, var(--text-top-control) 96%, transparent)
    );
}

@keyframes lesson-hud-energy {
    from {
        filter: saturate(0.98);
        opacity: 0.9;
    }
    to {
        filter: saturate(1.08);
        opacity: 1;
    }
}

@keyframes lesson-hud-fill-sweep {
    from {
        transform: translateX(-34%) skewX(-14deg);
    }
    to {
        transform: translateX(318%) skewX(-14deg);
    }
}

@keyframes lesson-hud-burst-in {
    0% {
        opacity: 0;
        transform: translateY(6px) scale(0.96);
    }
    20% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translateY(-5px) scale(1.01);
    }
}

#lessonHudLevel,
#lessonHudXp,
#lessonHudCoins,
#lessonHudStep,
#lessonHudProgress,
#lessonHudStreak,
#lessonHudPace {
    color: var(--text-top-control);
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum" 1;
}

@media (max-width: 960px) {
    .lesson-hud {
        width: min(330px, calc(100% - 18px));
        --lesson-hud-chip-font-size: clamp(11px, 0.68rem, 12px);
        --lesson-hud-meta-font-size: clamp(11px, 0.66rem, 12px);
    }

    .lesson-hud-chip-step {
        max-width: 140px;
    }

    .lesson-header-chip {
        min-height: 24px;
        padding: 0 var(--space-8);
    }
}

@media (prefers-reduced-motion: reduce) {
    .lesson-hud-fill,
    .lesson-hud-streak-fill {
        transition: none;
    }

    .lesson-hud[data-streak-tier="warm"] .lesson-hud-fill,
    .lesson-hud[data-streak-tier="hot"] .lesson-hud-fill,
    .lesson-hud[data-streak-tier="fire"] .lesson-hud-fill,
    .lesson-hud[data-streak-tier="warm"] .lesson-hud-streak-fill,
    .lesson-hud[data-streak-tier="hot"] .lesson-hud-streak-fill,
    .lesson-hud[data-streak-tier="fire"] .lesson-hud-streak-fill {
        animation: none;
    }

    .lesson-hud[data-streak-tier="warm"] .lesson-hud-fill::after,
    .lesson-hud[data-streak-tier="hot"] .lesson-hud-fill::after,
    .lesson-hud[data-streak-tier="fire"] .lesson-hud-fill::after,
    .lesson-hud[data-streak-tier="warm"] .lesson-hud-streak-fill::after,
    .lesson-hud[data-streak-tier="hot"] .lesson-hud-streak-fill::after,
    .lesson-hud[data-streak-tier="fire"] .lesson-hud-streak-fill::after {
        animation: none;
        opacity: 0;
    }

    .lesson-hud[data-burst="true"] .lesson-hud-burst {
        animation: none;
        opacity: 1;
        transform: none;
    }
}

.editor-pane[data-lesson-levelup="true"]::after {
    content: attr(data-lesson-level-label);
    position: absolute;
    top: var(--space-10);
    left: 50%;
    transform: translateX(-50%);
    z-index: 9;
    padding: var(--space-5) var(--space-10);
    border: 1px solid var(--border-focus-strong);
    background: linear-gradient(
        180deg,
        color-mix(in srgb, var(--surface-selected-soft) 44%, var(--surface-raised) 56%),
        color-mix(in srgb, var(--surface-raised) 88%, transparent)
    );
    color: var(--text-top-control);
    font-size: var(--text-size-xs);
    letter-spacing: 0.34px;
    pointer-events: none;
    animation: lesson-editor-levelup-banner 900ms var(--motion-ease) 1;
}

.editor-pane[data-lesson-levelup="true"] :is(.CodeMirror, #editor) {
    animation: lesson-editor-levelup-wave 780ms var(--motion-ease) 1;
}

@keyframes lesson-editor-levelup-wave {
    0% {
        box-shadow: 0 0 0 0 color-mix(in srgb, var(--surface-selected-soft) 44%, transparent);
        filter: saturate(1);
    }
    35% {
        box-shadow: 0 0 0 2px color-mix(in srgb, var(--surface-selected-soft) 48%, transparent);
        filter: saturate(1.2);
    }
    100% {
        box-shadow: 0 0 0 0 color-mix(in srgb, var(--surface-selected-soft) 0%, transparent);
        filter: saturate(1);
    }
}

@keyframes lesson-editor-levelup-banner {
    0% {
        opacity: 0;
        transform: translate(-50%, 8px) scale(0.95);
    }
    18% {
        opacity: 1;
        transform: translate(-50%, 0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translate(-50%, -10px) scale(1.02);
    }
}

@media (prefers-reduced-motion: reduce) {
    .editor-pane[data-lesson-levelup="true"]::after,
    .editor-pane[data-lesson-levelup="true"] :is(.CodeMirror, #editor) {
        animation: none;
    }
}

.editor-buttons {
    display: inline-flex;
    align-items: center;
    gap: var(--space-6);
    flex: 0 0 auto;
    white-space: nowrap;
    justify-self: start;
    opacity: 1;
    transform: none;
    pointer-events: auto;
    transition: opacity var(--motion-ui) var(--motion-ease), transform var(--motion-ui) var(--motion-ease);
}

.editor-pro-buttons {
    display: inline-flex;
    align-items: center;
    gap: var(--space-4);
    flex: 0 0 auto;
    white-space: nowrap;
    justify-self: end;
    margin-left: auto;
    opacity: 1;
    transform: none;
    pointer-events: auto;
    transition: opacity var(--motion-ui) var(--motion-ease), transform var(--motion-ui) var(--motion-ease);
}

.editor-pro-buttons button {
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    padding: 0 var(--space-10);
    font-size: var(--text-size-xs);
    letter-spacing: 0;
    border-radius: 0;
    border: 1px solid transparent;
    background: transparent;
    color: var(--text-top-control);
    box-shadow: none;
    font-weight: 500;
    text-decoration-line: none;
    text-decoration-thickness: 1.25px;
    text-underline-offset: 0.16em;
}

.editor-pro-buttons button:hover {
    background: transparent;
    border-color: transparent;
    text-decoration-line: underline;
    text-decoration-color: currentColor;
}

.editor-pro-buttons button:active {
    transform: none;
    background: transparent;
}

.editor-pro-buttons button:focus-visible {
    border-color: transparent;
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

.editor-pro-buttons button[data-active="true"],
.editor-pro-buttons button[aria-pressed="true"] {
    border-color: transparent;
    background: transparent;
    box-shadow: none;
    color: var(--text-top-control);
    text-decoration-line: underline;
    text-decoration-color: currentColor;
}

.editor-buttons button {
    flex: 0 0 auto;
    white-space: nowrap;
    min-width: 78px;
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    padding: 0 var(--space-10);
    font-size: var(--text-size-xs);
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.editor-panel:hover .editor-buttons,
.editor-panel:hover .editor-pro-buttons,
.editor-panel:focus-within .editor-buttons,
.editor-panel:focus-within .editor-pro-buttons {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}

@media (hover: none) {
    .editor-buttons,
    .editor-pro-buttons {
        opacity: 1;
        transform: none;
        pointer-events: auto;
    }
}

.editor-shortcut-help-btn {
    width: 26px;
    min-width: 26px;
    height: var(--control-height-xs);
    min-height: var(--control-height-xs);
    padding: 0;
    border-radius: 0;
    font-size: var(--text-size-xs);
    font-weight: 700;
    font-family: var(--font);
    line-height: 1;
}

.top.strip .top-shortcut-help-btn {
    width: auto;
    min-width: 0;
    height: var(--control-height-sm);
    min-height: var(--control-height-sm);
    padding: var(--space-4) var(--space-9);
    border-radius: 0;
    font-size: var(--text-size-xs);
    line-height: 1;
    font-weight: 500;
    font-family: inherit;
}

.editor-pane {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-width: 0;
    min-height: 0;
    overflow: hidden;
    contain: layout paint;
    position: relative;
}

.editor-completion {
    position: absolute;
    left: var(--space-8);
    top: var(--space-8);
    z-index: 6;
    border: 1px solid var(--border-soft);
    border-radius: 0;
    --editor-completion-alpha: 0.6;
    background: color-mix(in srgb, var(--surface-panel) calc(var(--editor-completion-alpha) * 100%), transparent);
    box-shadow: 0 0 0 1px var(--surface-soft);
    -webkit-backdrop-filter: blur(5px);
    backdrop-filter: blur(5px);
    width: min(360px, calc(100% - 16px));
    min-width: 220px;
    max-height: 190px;
    overflow: hidden;
    transform-origin: top left;
    animation: editor-completion-in var(--motion-fast) var(--motion-ease);
}

.editor-completion[data-placement="above"] {
    transform-origin: bottom left;
}

@keyframes editor-completion-in {
    from {
        opacity: 0;
        transform: translateY(2px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.editor-completion[aria-hidden="true"] {
    display: none;
}

.editor-completion-list {
    list-style: none;
    margin: 0;
    padding: var(--space-2) var(--space-3);
    display: grid;
    gap: 0;
    max-height: 190px;
    overflow: auto;
    scrollbar-width: thin;
}

.editor-completion-item {
    appearance: none;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-10);
    border: 0;
    border-radius: 0;
    background: transparent;
    box-shadow: none;
    color: var(--text);
    text-align: left;
    padding: 0 var(--space-7);
    min-height: 24px;
    font-size: var(--text-size-3xs);
    line-height: 1.2;
    font-weight: 500;
    position: relative;
    overflow: hidden;
}

.editor-completion-item::before {
    content: "";
    position: absolute;
    inset: 0;
    background: transparent;
    pointer-events: none;
    z-index: 0;
}

.editor-completion-item > * {
    position: relative;
    z-index: 1;
}

.editor-completion-item:hover,
.editor-completion-item[data-active="true"] {
    background: transparent;
    border-color: transparent;
}

.editor-completion-item:hover::before {
    background: var(--surface-soft);
}

.editor-completion-item[data-active="true"]::before {
    background: var(--surface-selected-soft);
}

.editor-completion-item:focus-visible {
    outline: none;
    box-shadow: none;
}

.editor-completion-item:focus-visible::before {
    box-shadow: inset 0 0 0 1px var(--ring-focus-soft);
}

.editor-completion-item:active {
    transform: none;
}

.editor-completion-item-main {
    min-width: 0;
    display: inline-flex;
    align-items: center;
    gap: var(--space-7);
}

.editor-completion-item-icon {
    width: 14px;
    min-width: 14px;
    height: 14px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted-quiet);
    line-height: 1;
}

.editor-completion-icon-svg {
    width: 12px;
    height: 12px;
    display: block;
}

.editor-completion-item-label {
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.editor-completion-item-sub {
    display: inline-flex;
    flex: 0 0 auto;
    color: var(--text-muted-quiet);
    font-size: var(--text-size-2xs);
    margin-left: var(--space-8);
}

.editor-inline-ghost {
    display: inline;
    color: var(--text-muted-quiet);
    opacity: 0.65;
    pointer-events: none;
    user-select: none;
}

.editor-signature-hint {
    position: absolute;
    left: var(--space-8);
    top: var(--space-8);
    z-index: 5;
    display: inline-flex;
    align-items: center;
    gap: 0;
    min-height: 18px;
    max-width: min(460px, calc(100% - 16px));
    padding: var(--space-2) var(--space-7);
    border: 1px solid var(--border-soft);
    border-radius: 0;
    background: color-mix(in srgb, var(--surface-panel) calc(var(--editor-completion-alpha) * 100%), transparent);
    box-shadow: 0 0 0 1px var(--surface-soft);
    -webkit-backdrop-filter: blur(5px);
    backdrop-filter: blur(5px);
    color: var(--text-muted-soft);
    font-size: var(--text-size-3xs);
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    pointer-events: none;
}

.editor-signature-hint[data-visible="false"] {
    display: none;
}

.editor-signature-hint-name {
    color: var(--text);
    font-family: var(--font);
}

.editor-signature-hint-param {
    color: var(--text-muted-soft);
}

.editor-signature-hint-param[data-active="true"] {
    color: var(--text);
}

.editor-panel .card-bd {
    flex: 1 1 0%;
    min-height: 0;
    overflow: hidden;
}

.editor-mirror {
    display: none;
    margin: 0;
    min-height: 0;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--surface-panel);
    color: var(--text-muted-soft);
    padding: var(--space-12);
    font-family: var(--font);
    font-size: var(--text-size-xs);
    line-height: 1.45;
    overflow: auto;
    scrollbar-gutter: stable both-edges;
    white-space: pre;
}

#editorPanel[data-editor-split="true"] .editor-pane {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    grid-template-rows: minmax(0, 1fr);
    gap: var(--space-8);
    align-items: stretch;
}

#editorPanel[data-editor-split="true"] #editor,
#editorPanel[data-editor-split="true"] .CodeMirror,
#editorPanel[data-editor-split="true"] .editor-mirror {
    width: 100%;
    min-width: 0;
    min-height: 0;
    height: 100%;
    box-sizing: border-box;
}

#editorPanel[data-editor-split="true"] .editor-mirror {
    display: block;
    overflow: auto;
    scrollbar-gutter: stable both-edges;
}

.editor-tabs {
    display: flex;
    align-items: center;
    gap: var(--space-8);
    padding: 0 0 var(--space-6);
    border-bottom: 1px solid var(--border-soft);
    min-height: var(--control-height-lg);
}

.editor-scope-bar {
    display: flex;
    align-items: center;
    gap: var(--space-8);
    min-height: 0;
    padding: var(--space-4) 0 var(--space-6);
    border-bottom: 1px solid var(--border-soft);
    max-height: 0;
    opacity: 0;
    transform: translateY(calc(var(--space-6) * -1));
    overflow: hidden;
    pointer-events: none;
    transition:
        max-height var(--motion-layout) var(--motion-ease),
        opacity var(--motion-layout) var(--motion-ease),
        transform var(--motion-layout) var(--motion-ease);
}

.editor-scope-bar[data-visible="true"] {
    min-height: var(--control-height-sm);
    max-height: 64px;
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}

.editor-scope-label {
    flex: 0 0 auto;
    font-size: var(--text-size-2xs);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-ui-strong);
    color: var(--text-muted-quiet);
}

.editor-scope-trail {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    min-width: 0;
    overflow-x: auto;
    overflow-y: hidden;
    scrollbar-width: thin;
}

.editor-scope-item {
    display: inline-flex;
    align-items: center;
    gap: var(--space-6);
    min-height: var(--control-height-xs);
    padding: 0 var(--space-8);
    border: 1px solid transparent;
    border-radius: 0;
    background: transparent;
    color: var(--text);
    font-size: var(--text-size-xs);
    white-space: nowrap;
    transition:
        border-color var(--motion-ui) var(--motion-ease),
        background var(--motion-ui) var(--motion-ease),
        color var(--motion-ui) var(--motion-ease),
        transform var(--motion-ui) var(--motion-ease);
}

.editor-scope-item:hover {
    border-color: var(--border-control);
    background: var(--surface-panel-hover);
    transform: translateY(-1px);
}

.editor-scope-item[data-active="true"] {
    border-color: var(--border-focus);
    background: var(--surface-elevated-focus);
}

.editor-scope-item:focus-visible {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

.editor-scope-item-name {
    color: var(--text);
    font-family: var(--font);
}

.editor-scope-item-kind {
    color: var(--text-muted-quiet);
    font-size: var(--text-size-2xs);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-ui);
}

.editor-scope-sep {
    color: var(--text-muted-quiet);
    font-size: var(--text-size-2xs);
    user-select: none;
}

@media (prefers-reduced-motion: reduce) {
    .editor-scope-bar,
    .editor-scope-item {
        transition: none !important;
        transform: none !important;
    }
}

.editor-tabs-list {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    flex: 1;
    min-width: 0;
    overflow-x: auto;
    overflow-y: hidden;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb-hover) transparent;
    -ms-overflow-style: auto;
}

.editor-tabs-list::-webkit-scrollbar {
    height: var(--scrollbar-size);
}

.editor-tabs-list::-webkit-scrollbar-track {
    background: transparent;
}

.editor-tabs-list::-webkit-scrollbar-thumb {
    border-radius: var(--radius-pill);
    border: 1px solid transparent;
    background: var(--scrollbar-thumb-hover);
    background-clip: padding-box;
}

.editor-tabs-list::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
    background-clip: padding-box;
}

.editor-tab {
    display: inline-flex;
    flex: 0 0 auto;
    align-items: center;
    gap: var(--space-6);
    padding: var(--space-6) var(--space-10);
    border-radius: 0;
    border: 1px solid transparent;
    background: var(--surface-panel-alt);
    color: var(--text);
    font-size: var(--text-size-3xs-plus);
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
}

.editor-tab:hover {
    border-color: var(--border);
    background: var(--surface-panel-hover);
}

.editor-tab[data-active="true"] {
    border-color: var(--border-focus);
    background: var(--surface-elevated-focus);
    box-shadow: inset 0 -2px 0 var(--border-focus);
}

.editor-tab[data-dirty="true"] {
    border-color: var(--health-warn-border);
}

.editor-tab:focus-visible {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

.editor-tab-label {
    max-width: 180px;
    overflow: hidden;
    text-overflow: ellipsis;
}

.editor-tab-dirty {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 10px;
    color: var(--status-warn-text);
    font-size: var(--text-size-xs);
    line-height: 1;
    font-weight: 700;
}

.editor-tab-close {
    width: 18px;
    height: 18px;
    min-width: 18px;
    min-height: 18px;
    padding: 0;
    border-radius: 0;
    border: 0;
    background: transparent;
    color: var(--muted);
    font-size: var(--text-size-xs);
    font-weight: 600;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.editor-tab-close:hover {
    background: var(--surface-soft);
    color: var(--text);
}

.editor-tab-close:disabled {
    opacity: 0.35;
    cursor: not-allowed;
}

.files-panel {
    --files-stack-gap: 2px;
    --files-column-gutter: 0px;
    --files-tab-edge-space: 4px;
    --files-section-inset: var(--files-tab-edge-space);
    --files-tree-line-color: var(--files-tree-guide);
    width: 100%;
    flex: 1;
    min-width: 0;
    border: 0;
    border-radius: 0;
    background: transparent;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: var(--files-stack-gap);
    min-height: 0;
    position: relative;
}

.files-panel[data-filters="closed"] .files-toolbar {
    display: none;
}

.files-panel[data-games="closed"] #filesGames {
    display: none;
}

.files-panel[data-apps="closed"] #filesApps {
    display: none;
}

.files-panel[data-lessons="closed"] #filesLessons {
    display: none;
}

.files-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-12);
    padding: 0 var(--panel-header-pad-x, var(--space-10));
    height: var(--panel-header-height, 46px);
    min-height: var(--panel-header-height, 46px);
    border-bottom: 1px solid var(--border-soft);
    background: var(--surface-panel);
    box-sizing: border-box;
    overflow-x: auto;
    overflow-y: hidden;
    margin-bottom: var(--files-tab-edge-space);
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb-hover) transparent;
    -webkit-overflow-scrolling: touch;
}

.files-header::-webkit-scrollbar {
    height: var(--scrollbar-size);
}

.files-header::-webkit-scrollbar-track {
    background: transparent;
}

.files-header::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
}

.files-header::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
}

.files-header > * {
    flex: 0 0 auto;
    min-width: max-content;
}

.files-title-row {
    display: flex;
    align-items: center;
    gap: var(--space-8);
    min-height: var(--control-height-lg);
}

.files-actions {
    display: inline-flex;
    align-items: center;
    gap: var(--space-4);
    flex-wrap: nowrap;
}

.files-actions button:not(.files-menu-btn) {
    height: var(--control-height-lg);
    min-height: var(--control-height-lg);
    padding: 0 var(--space-8);
    font-size: var(--text-size-xs);
}

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: calc(var(--space-1) * -1);
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

.files-title {
    margin: 0;
    font-size: var(--panel-title-size, 13px);
    font-weight: 700;
    color: var(--text);
    letter-spacing: 0;
    line-height: 1;
    text-transform: lowercase;
}

.files-title::first-letter {
    text-transform: uppercase;
}

.files-header .files-menu-btn {
    width: 28px;
    min-width: 28px;
    height: var(--control-height-sm);
    min-height: var(--control-height-sm);
    padding: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-size-md);
    line-height: 1;
    letter-spacing: 0;
    text-align: center;
    border-radius: var(--radius-sm);
}

.files-sub {
    margin: var(--space-2) 0 0;
    font-size: var(--text-size-5xs);
    letter-spacing: 0.28px;
    color: var(--text-muted-quiet);
}

.files-toolbar {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: var(--space-6);
    padding: 0;
}

.files-search {
    flex: 1;
    display: flex;
    align-items: center;
    gap: var(--space-5);
    padding: var(--space-1) var(--space-6);
    border-radius: var(--radius-sm);
    border: 1px solid var(--files-search-border);
    background: var(--files-search-bg);
}

.files-search:focus-within {
    border-color: var(--btn-pressed-border);
    box-shadow: 0 0 0 1px var(--btn-pressed-shadow);
}

#fileSearch {
    width: 100%;
    height: 20px;
    padding: 0 var(--space-4);
    border-radius: var(--radius-sm);
    border: 0;
    background: transparent;
    color: var(--text);
    font-size: var(--text-size-xs);
}

#fileSearch:focus {
    outline: none;
    box-shadow: none;
}

#fileSearchClear {
    height: 20px;
    padding: 0 var(--space-6);
    border-radius: var(--radius-sm);
    border: 0;
    background: transparent;
    color: var(--text-muted-soft);
    font-size: var(--text-size-4xs);
}

#fileSearchClear[data-active="false"] {
    opacity: 0.4;
    pointer-events: none;
}

.files-sort select {
    height: var(--control-height-compact);
    padding: 0 var(--space-8);
    border-radius: var(--radius-sm);
    border: 1px solid var(--files-search-border);
    background: var(--files-search-bg);
    color: var(--text);
    font-size: var(--text-size-4xs);
}

.files-games {
    display: flex;
    flex-direction: column;
    gap: 0;
    padding: 0;
    padding-right: var(--files-column-gutter);
    margin-top: 0;
    border-top: 0;
    min-height: 0;
    box-sizing: border-box;
}

.files-games[aria-hidden="true"] {
    display: none;
}

.files-games-row {
    display: flex;
    flex-direction: column;
    gap: var(--files-stack-gap);
    width: 100%;
    min-height: 0;
    padding: 0 var(--files-section-inset);
    margin-left: calc(var(--files-column-gutter) / 2);
    box-sizing: border-box;
}

.files-games-toggle {
    margin: 0;
}

.files-games-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    max-height: 160px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb-hover) transparent;
}

.files-games-list[aria-hidden="true"] {
    display: none;
}

.files-games[data-list-open="false"] #gameLoad,
.files-games[data-list-open="false"] #appLoad,
.files-games[data-list-open="false"] #lessonLoad {
    display: none;
}

.files-games-list::-webkit-scrollbar {
    width: var(--scrollbar-size);
}

.files-games-list::-webkit-scrollbar-track {
    background: transparent;
}

.files-games-list::-webkit-scrollbar-thumb {
    border-radius: var(--radius-pill);
    border: var(--scrollbar-thumb-border) solid transparent;
    background: var(--scrollbar-thumb);
    background-clip: padding-box;
}

.files-games-list::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
    background-clip: padding-box;
}

.files-games-item {
    margin: 0;
    padding: 0;
}

.files-games-option {
    width: 100%;
    min-height: 24px;
    padding: var(--space-4) var(--space-6);
    border-radius: 0;
    border: 1px solid transparent;
    background: transparent;
    color: var(--files-option-text);
    font-size: var(--text-size-4xs);
    text-align: left;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--space-6);
}

.files-games-option-icon {
    width: 14px;
    height: 14px;
    flex: 0 0 14px;
    object-fit: contain;
    opacity: 0.95;
    pointer-events: none;
}

.files-games-option-icon.is-hidden {
    display: none;
}

.files-games-option-label {
    min-width: 0;
    flex: 1;
}

.files-games-option:hover {
    border-color: transparent;
    background: var(--files-option-hover-bg);
}

.files-games-option:focus-visible {
    outline: none;
    border-color: var(--btn-pressed-border);
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

.files-games-option[data-selected="true"] {
    border-color: transparent;
    background: var(--files-option-selected-bg);
    color: var(--files-option-selected-text);
}

#gameLoad,
#appLoad {
    width: 100%;
    margin: 0;
    height: var(--control-height-md);
    min-height: var(--control-height-md);
    padding: var(--space-4) var(--space-6);
    font-size: var(--text-size-xs);
    border-radius: 0;
    font-weight: 600;
    letter-spacing: var(--letter-spacing-ui-plus);
    text-transform: uppercase;
    text-align: center;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.files-menu-btn {
    width: var(--control-size-sm);
    height: var(--control-size-sm);
    padding: 0;
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: transparent;
    color: var(--muted);
    font-size: var(--text-size-xs);
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.files-menu {
    position: fixed;
    min-width: 168px;
    max-width: 240px;
    padding: var(--space-8);
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--menu-bg);
    box-shadow: var(--menu-shadow);
    max-height: min(68vh, 520px);
    overflow-x: hidden;
    overflow-y: auto;
    scroll-behavior: smooth;
    display: none;
    z-index: 1550;
}

.files-menu[data-open="true"] {
    display: block;
}

#filesMenu {
    width: min(306px, calc(100vw - 18px));
    min-width: 268px;
    max-width: 306px;
}

#fileRowMenu {
    min-width: 168px;
    max-width: 220px;
}

#fileFolderMenu {
    min-width: 180px;
    max-width: 240px;
}

.files-menu-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
}

.files-menu-group + .files-menu-group {
    margin-top: var(--space-8);
    padding-top: var(--space-8);
    border-top: 1px solid var(--border-soft);
}

.files-menu-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--space-6);
}

.files-menu-grid-2 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
}

.files-menu-grid-3 {
    grid-template-columns: repeat(3, minmax(0, 1fr));
}

.files-menu-label {
    margin: 0;
    font-size: var(--text-size-5xs-plus);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-ui-strong);
    line-height: 1;
    color: var(--text-muted-quiet);
}

.files-menu-item {
    width: 100%;
    text-align: left;
    padding: var(--space-7) var(--space-8);
    border-radius: 0;
    border: 1px solid transparent;
    background: transparent;
    color: var(--text);
    font-size: var(--text-size-xs);
    line-height: 1.2;
    cursor: pointer;
    min-height: var(--control-height-md);
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

#filesMenu .files-menu-item {
    text-align: center;
    padding: var(--space-6) var(--space-6);
    min-height: var(--control-height-sm);
    border-radius: 0;
    font-size: var(--text-size-4xs-quarter);
    line-height: 1.2;
    letter-spacing: 0.08px;
}

#fileRowMenu .files-menu-item {
    text-align: left;
    font-size: var(--text-size-3xs-quarter);
    min-height: var(--control-height-md);
}

#fileFolderMenu .files-menu-item {
    text-align: left;
    font-size: var(--text-size-3xs-quarter);
    min-height: var(--control-height-md);
}

.files-menu-item:hover {
    border-color: var(--btn-primary-border);
    background: var(--surface-active);
}

.files-menu-item:focus-visible {
    outline: none;
    border-color: var(--btn-pressed-border);
    box-shadow: 0 0 0 1px var(--ring-focus);
}

.files-menu-item:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.files-menu-item[data-variant="danger"] {
    color: var(--danger);
    border-color: var(--menu-danger-border);
    background: var(--menu-danger-bg);
}

.files-menu-item[data-variant="danger"]:hover,
.files-menu-item[data-variant="danger"]:focus-visible {
    border-color: var(--menu-danger-border-hover);
    background: var(--menu-danger-bg-hover);
}

#filesMenu [data-files-toggle][aria-pressed="true"] {
    border-color: var(--btn-pressed-border);
    background: var(--surface-active);
}

#filesMenu [data-files-menu="delete-all"] {
    grid-column: 1 / -1;
}

@media (max-width: 620px) {
    #filesMenu {
        min-width: 0;
        width: min(96vw, 306px);
    }

    #filesMenu .files-menu-grid,
    #filesMenu .files-menu-grid-2,
    #filesMenu .files-menu-grid-3 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }
}

.file-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb-hover) transparent;
    flex: 1;
    min-height: 0;
    max-height: none;
}

.file-list[data-root-drop-target="true"] {
    box-shadow: inset 0 0 0 1px var(--drop-target-border);
    background: var(--surface-drop-target);
}

.file-list::-webkit-scrollbar {
    width: var(--scrollbar-size);
}

.file-list::-webkit-scrollbar-track {
    background: transparent;
}

.file-list::-webkit-scrollbar-thumb {
    border-radius: var(--radius-pill);
    border: var(--scrollbar-thumb-border) solid transparent;
    background: var(--scrollbar-thumb);
    background-clip: padding-box;
}

.file-list::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
    background-clip: padding-box;
}

.file-section {
    margin: var(--space-5) 0 0;
    padding: var(--space-2) var(--space-4);
    font-size: var(--text-size-6xs-plus);
    text-transform: uppercase;
    letter-spacing: 0.38px;
    color: var(--text-muted-quiet);
}

.file-section-header {
    display: flex;
    align-items: stretch;
    gap: var(--files-stack-gap);
    margin: 0;
    margin-left: calc(var(--files-column-gutter) / 2);
    padding: 0 var(--files-section-inset);
    box-sizing: border-box;
}

.file-section-slot {
    list-style: none;
    margin: 0;
    padding: 0;
}

.file-list > .file-section-slot-static:not(:first-child) {
    margin-top: var(--files-stack-gap);
}

.file-list > .file-section-header:not(:first-child) {
    margin-top: var(--files-stack-gap);
}

.file-list > .file-section-header + li {
    margin-top: var(--files-stack-gap);
}

.file-section-toggle {
    flex: 1;
    min-width: 0;
    width: 100%;
    min-height: var(--control-height-md);
    height: var(--control-height-md);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-6);
    padding: var(--space-4) var(--space-6);
    border-radius: 0;
    border: 0;
    background: var(--files-section-bg);
    color: var(--files-section-text);
    font-size: var(--text-size-xs);
    font-weight: 600;
    line-height: 1;
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-ui-plus);
    cursor: pointer;
}

.file-section-toggle[data-files-section-id] {
    cursor: grab;
    user-select: none;
}

.file-section-toggle[data-files-section-id]:active {
    cursor: grabbing;
}

.file-section-toggle[data-dragging-section="true"] {
    opacity: 0.7;
}

.file-section-toggle[data-drop-before="true"] {
    box-shadow: inset 0 2px 0 var(--ring-focus), 0 0 0 1px var(--drop-target-border);
}

.file-section-toggle[data-drop-after="true"] {
    box-shadow: inset 0 -2px 0 var(--ring-focus), 0 0 0 1px var(--drop-target-border);
}

.file-section-action {
    width: 30px;
    min-width: 30px;
    height: var(--control-height-md);
    min-height: var(--control-height-md);
    border-radius: 0;
    border: 0;
    background: var(--files-section-bg);
    color: var(--files-section-text);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    line-height: 0;
}

.file-section-action:hover {
    background: var(--files-section-bg-hover);
}

.file-section-action:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

.file-section-action[data-variant="danger"]:hover {
    background: var(--section-danger-hover-bg);
    color: var(--danger-contrast-text);
}

.file-section-action-mark {
    position: relative;
    display: inline-block;
    width: 14px;
    height: 14px;
}

.file-section-action-mark::before,
.file-section-action-mark::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 14px;
    height: 2px;
    border-radius: var(--radius-pill);
    background: currentColor;
    transform-origin: center;
}

.file-section-action-mark::before {
    transform: translate(-50%, -50%) rotate(45deg);
}

.file-section-action-mark::after {
    transform: translate(-50%, -50%) rotate(-45deg);
}

.file-section-toggle[data-caret-side="left"] {
    justify-content: flex-start;
}

.file-section-toggle:hover {
    border-color: transparent;
    background: var(--files-section-bg-hover);
}

.file-section-toggle[aria-expanded="true"] {
    background: var(--files-section-bg-open);
    color: var(--text-accent-strong);
}

.file-section-toggle:focus-visible {
    outline: none;
    border-color: transparent;
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

.file-section-label {
    text-align: left;
}

.file-section-toggle[data-caret-side="left"] .file-section-label {
    margin-left: var(--space-2);
}

.file-section-toggle[data-caret-side="right"] .file-section-label {
    margin-right: var(--space-2);
}

.file-section-caret {
    display: inline-block;
    flex: 0 0 auto;
    width: 10px;
    height: 10px;
    box-sizing: border-box;
    margin-left: var(--space-2);
    border-right: 1.5px solid var(--files-caret-color);
    border-bottom: 1.5px solid var(--files-caret-color);
    transform: translateY(0) rotate(45deg);
    transform-origin: 50% 50%;
    transition: transform var(--motion-ui) var(--motion-ease);
}

.file-section-toggle[aria-expanded="false"] .file-section-caret {
    transform: translateY(0) rotate(-45deg);
}

.file-section-toggle[aria-expanded="true"] .file-section-caret {
    transform: translateY(-3px) rotate(45deg);
}

.file-item {
    display: flex;
    gap: 0;
    align-items: stretch;
    width: 100%;
    margin-left: calc(var(--files-column-gutter) / 2);
    padding: 0 var(--files-section-inset);
    box-sizing: border-box;
}

.file-item-folder {
    align-items: stretch;
}

.file-folder-row {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-6);
    min-height: 24px;
    padding: var(--space-4) var(--space-6) var(--space-4) calc(var(--space-6) + (var(--file-depth, 0) * var(--space-12)));
    border-radius: 0;
    border: 1px solid transparent;
    background: transparent;
    -webkit-appearance: none;
    appearance: none;
    color: var(--files-option-text);
    font-size: var(--text-size-4xs);
    cursor: pointer;
    text-align: left;
    position: relative;
    overflow: hidden;
    margin: 0;
    box-sizing: border-box;
}

.file-folder-row::before {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    left: calc(-1px + (var(--file-depth, 0) * 12px));
    right: 0;
    background: transparent;
    pointer-events: none;
    z-index: 0;
}

.file-folder-row > :not(.file-tree-guides) {
    position: relative;
    z-index: 1;
}

.file-folder-row[data-drop-target="true"] {
    border-color: transparent;
    box-shadow: inset 0 0 0 1px var(--drop-target-border);
    background: transparent;
}

.file-folder-row[data-drop-target="true"]::before {
    box-shadow: none;
    background: transparent;
}

.file-folder-row:hover {
    border-color: transparent;
    background: transparent;
}

.file-folder-row:hover::before {
    background: transparent;
}

.file-folder-row[data-selected="true"] {
    border-color: transparent;
    background: transparent;
}

.file-folder-row[data-selected="true"]::before {
    background: var(--surface-selected-soft);
}

.file-folder-row:focus-visible {
    outline: none;
    border-color: transparent;
    box-shadow: none;
}

.file-folder-row:focus-visible::before {
    box-shadow: none;
}

.file-folder-row[data-editing="true"] {
    cursor: text;
    border-color: transparent;
    background: transparent;
    box-shadow: inset 0 0 0 1px var(--border-focus-soft);
}

.file-folder-row[data-editing="true"]::before {
    background: transparent;
    box-shadow: none;
}

.file-folder-name-wrap {
    display: inline-flex;
    align-items: center;
    gap: var(--space-6);
    padding-left: var(--space-1);
    flex: 1;
    min-width: 0;
    max-width: 100%;
    justify-content: flex-start;
    text-align: left;
    overflow: hidden;
}

.file-folder-icon {
    width: 14px;
    height: 14px;
    flex: 0 0 14px;
    display: inline-block;
    object-fit: contain;
    object-position: center;
    pointer-events: none;
    user-select: none;
    opacity: var(--folder-icon-opacity);
    filter: var(--folder-icon-filter);
}

.file-folder-name-wrap-editing {
    display: flex;
    flex: 1;
    min-width: 0;
    gap: var(--space-4);
    flex-direction: column;
}

.file-folder-rename {
    width: 100%;
}

.file-folder-caret {
    display: inline-block;
    flex: 0 0 auto;
    width: 10px;
    height: 10px;
    box-sizing: border-box;
    margin-left: var(--space-2);
    border-right: 1.5px solid var(--files-caret-color);
    border-bottom: 1.5px solid var(--files-caret-color);
    transform: translateY(0) rotate(45deg);
    transform-origin: 50% 50%;
    transition: transform var(--motion-ui) var(--motion-ease);
}

.file-folder-row[aria-expanded="false"] .file-folder-caret {
    transform: translateY(0) rotate(-45deg);
}

.file-folder-row[aria-expanded="true"] .file-folder-caret {
    transform: translateY(-3px) rotate(45deg);
}

.file-folder-name {
    display: block;
    min-width: 0;
    max-width: 100%;
    font-size: var(--text-size-4xs);
    line-height: 1.2;
    color: var(--text-muted-soft);
    text-align: left;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.file-folder-count {
    flex: 0 0 auto;
    font-size: var(--text-size-4xs);
    color: var(--text-muted-quiet);
}

.file-row {
    flex: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-4) var(--space-6) var(--space-4) calc(var(--space-6) + (var(--file-depth, 0) * var(--space-12)));
    min-height: 24px;
    gap: var(--space-6);
    border-radius: 0;
    border: 1px solid transparent;
    background: transparent;
    -webkit-appearance: none;
    appearance: none;
    cursor: pointer;
    transition: border-color var(--motion-ui) var(--motion-ease), background var(--motion-ui) var(--motion-ease), box-shadow var(--motion-ui) var(--motion-ease), transform var(--motion-fast) var(--motion-ease), color var(--motion-ui) var(--motion-ease);
    position: relative;
    overflow: hidden;
    margin: 0;
    box-sizing: border-box;
}

.file-row-icon {
    width: 14px;
    height: 14px;
    flex: 0 0 14px;
    display: inline-block;
    object-fit: contain;
    object-position: center;
    pointer-events: none;
    user-select: none;
    opacity: var(--file-icon-opacity);
    filter: var(--file-icon-filter);
}

.file-row::before {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    left: calc(-1px + (var(--file-depth, 0) * 12px));
    right: 0;
    background: transparent;
    pointer-events: none;
    z-index: 0;
}

.file-row[data-editing="true"] .file-row-icon {
    opacity: 0.65;
}

.file-row > :not(.file-tree-guides) {
    position: relative;
    z-index: 1;
}

.file-row[draggable="true"] {
    cursor: pointer;
}

.file-row[data-dragging="true"] {
    opacity: 0.56;
    border-style: dashed;
    cursor: grabbing;
}


.file-tree-guides {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 0;
}

.file-tree-guide {
    position: absolute;
    top: -1px;
    bottom: -1px;
    width: 1px;
    background: var(--files-tree-line-color);
    border-left: 0;
}

.file-row[data-editing="true"] {
    cursor: text;
    border-color: transparent;
    background: transparent;
    box-shadow: none;
}

.file-row[data-editing="true"]::before {
    background: var(--surface-panel-alt);
    box-shadow: inset 0 0 0 1px var(--border-focus-soft);
}

.file-row:hover {
    border-color: transparent;
    background: transparent;
}

.file-row:hover::before {
    background: var(--surface-soft);
}

.file-row[data-selected="true"]:not([data-active="true"]) {
    border-color: transparent;
    background: transparent;
    box-shadow: none;
}

.file-row[data-selected="true"]:not([data-active="true"])::before {
    background: var(--surface-selected-soft);
}

.file-row:focus-visible {
    outline: none;
    border-color: transparent;
    box-shadow: none;
}

.file-row:focus-visible::before {
    box-shadow: 0 0 0 1px var(--ring-focus-soft);
}

.files-panel .file-list {
    /* File list should scroll inside the sidebar without stretching the page */
    min-height: 0;
}

.file-row[data-active="true"] {
    border-color: transparent;
    background: transparent;
    box-shadow: none;
}

.file-row[data-active="true"]::before {
    background: var(--surface-selected);
}

.file-row-trash {
    cursor: pointer;
    border-style: dashed;
    border-color: var(--border-soft);
    background: var(--surface-soft);
}

.file-row-trash:hover::before {
    background: var(--surface-selected);
}

.file-row-trash .file-name {
    color: var(--text-muted-soft);
}

.file-row-trash .file-info {
    color: var(--text-muted-quiet);
    opacity: 1;
}

.card.panel-floating,
.side.panel-floating {
    position: relative;
    z-index: 1600;
    transform: translateY(-6px) scale(1.01);
    box-shadow: var(--menu-shadow);
    border-color: var(--drop-target-border);
    transition: transform var(--motion-ui) cubic-bezier(0.22, 1, 0.36, 1), box-shadow var(--motion-ui) var(--motion-ease), border-color var(--motion-ui) var(--motion-ease);
    will-change: transform;
}

.panel-drag-source {
    opacity: 0.35;
    filter: saturate(0.9);
}

.panel-ghost {
    position: fixed;
    top: 0;
    left: 0;
    pointer-events: none;
    border-radius: var(--radius);
    border: 1px solid var(--drop-target-border);
    background: var(--surface-panel-alt);
    box-shadow: var(--menu-shadow);
    z-index: 1700;
    transform-origin: center;
    transition: box-shadow var(--motion-fast) var(--motion-ease);
    will-change: transform;
    contain: layout style paint;
}

.panel-ghost-title {
    position: absolute;
    top: var(--space-10);
    left: var(--space-12);
    padding: var(--space-4) var(--space-8);
    border-radius: var(--radius-pill);
    border: 1px solid var(--drop-target-border);
    background: var(--surface-panel);
    color: var(--text-top-control);
    font-size: var(--text-size-2xs);
    letter-spacing: var(--letter-spacing-ui-strong);
    text-transform: uppercase;
}

.file-name-wrap {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    min-width: 0;
    align-items: flex-start;
    justify-content: flex-start;
    text-align: left;
    flex: 1;
    max-width: 100%;
    overflow: hidden;
}

.file-name {
    font-family: var(--font);
    font-size: var(--text-size-4xs);
    line-height: 1.2;
    color: var(--text);
    display: block;
    width: 100%;
    max-width: 100%;
    text-align: left;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.file-active-tag {
    display: inline-flex;
    align-items: center;
    align-self: center;
    padding: 0;
    margin-left: auto;
    flex: 0 0 auto;
    border: 0;
    background: transparent;
    color: var(--accent-info);
    font-size: var(--text-size-6xs);
    line-height: 1;
    transform: translateY(1px);
    letter-spacing: 0.24px;
    font-weight: 700;
    text-transform: uppercase;
}

.file-info {
    font-size: var(--text-size-5xs);
    color: var(--muted);
    letter-spacing: var(--letter-spacing-tight);
    opacity: 0.7;
    transition: opacity var(--motion-ui) var(--motion-ease);
}

.file-row[data-pinned="true"] .file-info::before {
    content: "Pinned | ";
    color: var(--accent-info);
}

.file-row[data-locked="true"] .file-info {
    color: var(--status-warn-text);
}

.file-row:hover .file-info,
.file-row[data-active="true"] .file-info,
.file-row[data-selected="true"] .file-info {
    opacity: 0.9;
}

.file-row[data-dirty="true"] .file-name {
    color: var(--status-warn-text);
}

.file-meta {
    display: inline-flex;
    align-items: center;
    padding: 0;
    border: 0;
    background: transparent;
    color: var(--accent-info);
    font-size: var(--text-size-6xs);
    letter-spacing: 0.24px;
    font-weight: 600;
    text-transform: uppercase;
    white-space: nowrap;
    margin-left: var(--space-4);
}

.file-meta + .file-meta {
    margin-left: var(--space-6);
}

.file-rename {
    width: 100%;
    border: 1px solid var(--border);
    background: var(--surface-panel);
    color: var(--text);
    font-family: var(--font);
    font-size: var(--text-size-4xs);
    line-height: 1.2;
    padding: var(--space-4) var(--space-6);
    border-radius: var(--radius-sm);
}

.file-rename[aria-invalid="true"] {
    border-color: var(--danger);
    box-shadow: 0 0 0 2px var(--diagnostic-error-ring);
}

.file-rename:focus {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 2px var(--ring-focus);
}

.file-error {
    display: block;
    font-size: var(--text-size-4xs);
    color: var(--danger);
    white-space: normal;
}


/* Dock overlay */
.dock-overlay {
    position: fixed;
    inset: 0;
    --dock-side-inset: 3.5%;
    --dock-side-width: 23%;
    --dock-vertical-inset: 6%;
    --dock-bottom-height: 24%;
    --dock-bottom-inset: 4.5%;
    --dock-zone-gap: 2%;
    display: flex;
    align-items: stretch;
    justify-content: stretch;
    pointer-events: none;
    z-index: 1200;
    opacity: 0;
    visibility: hidden;
    transition: opacity var(--motion-ui) var(--motion-ease), visibility 0s linear var(--motion-ui);
    contain: layout style paint;
}

.dock-overlay[data-active="true"] {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transition: opacity var(--motion-ui) var(--motion-ease);
    will-change: opacity;
}

.dock-overlay::before {
    content: "";
    position: absolute;
    inset: 0;
    background: var(--overlay-backdrop-soft);
    pointer-events: none;
}

.dock-zone {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid transparent;
    background: transparent;
    color: var(--text-secondary);
    font-size: var(--text-size-4xs);
    font-weight: 700;
    letter-spacing: 0;
    line-height: 1;
    text-transform: none;
    opacity: 0.62;
    transition:
        opacity var(--motion-fast) var(--motion-ease),
        border-color var(--motion-fast) var(--motion-ease),
        background-color var(--motion-fast) var(--motion-ease);
    pointer-events: auto;
    border-radius: var(--radius-sm);
    padding: 0;
    z-index: 2;
    box-shadow: inset 0 0 0 1px var(--surface-elevated-alt);
}

.dock-zone[data-active="true"] {
    opacity: 1;
    border-color: var(--border-focus);
    background: var(--ring-focus-soft);
    color: var(--text-primary);
    box-shadow: inset 0 0 0 1px var(--drop-target-border);
}

.dock-zone::before,
.dock-zone::after {
    display: none;
}

.dock-center {
    z-index: 3;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 120px;
    height: 84px;
    border-radius: var(--radius-sm);
    border-color: var(--border-soft);
    background: var(--ring-focus-soft);
}

.dock-center[data-active="true"] {
    transform: translate(-50%, -50%);
}

.dock-center::before,
.dock-center::after {
    display: none;
}

.dock-left,
.dock-right,
.dock-bottom {
    position: absolute;
    border-color: var(--border-soft);
    background: var(--surface-elevated-alt);
}

.dock-left,
.dock-right {
    top: var(--dock-vertical-inset);
    bottom: calc(var(--dock-bottom-inset) + var(--dock-bottom-height) + var(--dock-zone-gap));
    width: var(--dock-side-width);
}

.dock-left {
    left: var(--dock-side-inset);
}

.dock-right {
    right: var(--dock-side-inset);
}

.dock-bottom {
    left: calc(var(--dock-side-inset) + var(--dock-side-width) + var(--dock-zone-gap));
    right: calc(var(--dock-side-inset) + var(--dock-side-width) + var(--dock-zone-gap));
    height: var(--dock-bottom-height);
    bottom: var(--dock-bottom-inset);
}

.dock-overlay[data-active-zone="left"] .dock-left,
.dock-overlay[data-active-zone="right"] .dock-right,
.dock-overlay[data-active-zone="bottom"] .dock-bottom,
.dock-overlay[data-active-zone="center"] .dock-center {
    border-color: var(--border-focus);
    background: var(--ring-focus-soft);
    opacity: 1;
}

body.dock-dragging {
    cursor: grabbing;
}

body[data-resize="col"] {
    cursor: col-resize;
    user-select: none;
}

body[data-resize="row"] {
    cursor: row-resize;
    user-select: none;
}

@media (prefers-reduced-motion: reduce) {
    .dock-overlay,
    .dock-zone,
    .dock-zone::before,
    .dock-zone::after,
    .panel-ghost,
    .card.panel-floating,
    .side.panel-floating {
        transition: none !important;
    }
}

/* Layout panel */

.layout-backdrop {
    position: fixed;
    inset: 0;
    background: var(--overlay-backdrop);
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--motion-layout) var(--motion-ease);
    z-index: 1250;
}

.layout-panel {
    position: fixed;
    top: 0;
    right: 0;
    width: min(360px, 92vw);
    max-height: var(--modal-viewport-max-height);
    display: flex;
    flex-direction: column;
    gap: var(--modal-gap);
    padding: var(--modal-padding);
    border-radius: var(--modal-radius);
    border: 1px solid var(--modal-border-color);
    background: var(--modal-surface);
    box-shadow: var(--modal-shadow);
    opacity: 0;
    transform: translateY(0);
    pointer-events: none;
    overflow-x: hidden;
    overflow-y: auto;
    transition: opacity var(--motion-layout) var(--motion-ease);
    z-index: 1300;
}

#layoutPanel {
    top: 50%;
    left: 50%;
    right: auto;
    width: min(420px, calc(100vw - 24px));
    max-height: min(var(--modal-max-height), var(--modal-viewport-max-height));
    padding: var(--modal-padding);
    gap: var(--modal-gap);
    border: 1px solid var(--modal-border-color);
    background: var(--modal-surface);
    box-shadow: var(--modal-shadow);
    transform: translate(-50%, calc(-50% - 10px));
    transform-origin: center center;
}

.layout-panel[data-open="true"] {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}

#layoutPanel[data-open="true"] {
    transform: translate(-50%, -50%);
}

#shortcutHelpPanel[data-open="true"],
#editorHistoryPanel[data-open="true"],
#editorSettingsPanel[data-open="true"],
#lessonStatsPanel[data-open="true"] {
    transform: translate(-50%, -50%);
}

.layout-backdrop[data-open="true"] {
    opacity: 1;
    pointer-events: auto;
}

.quick-open-backdrop {
    position: fixed;
    inset: 0;
    background: var(--overlay-backdrop);
    backdrop-filter: blur(2px);
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--motion-base) var(--motion-ease);
    z-index: 1450;
}

.quick-open-backdrop[data-open="true"] {
    opacity: 1;
    pointer-events: auto;
}

.quick-open {
    position: fixed;
    top: clamp(56px, 14vh, 140px);
    left: 50%;
    transform: translate(-50%, -8px);
    width: min(620px, calc(100vw - 28px));
    max-height: min(var(--modal-max-height), var(--modal-viewport-max-height));
    display: flex;
    flex-direction: column;
    gap: var(--modal-gap);
    padding: var(--modal-padding);
    border-radius: var(--modal-radius);
    border: 1px solid var(--modal-border-color);
    background: var(--modal-surface);
    box-shadow: var(--modal-shadow);
    overflow-x: hidden;
    overflow-y: auto;
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--motion-base) var(--motion-ease), transform var(--motion-base) var(--motion-ease);
    z-index: 1500;
}

.command-palette {
    top: clamp(48px, 12vh, 120px);
    width: min(660px, calc(100vw - 24px));
    z-index: 1520;
}

.command-palette-item[data-disabled="true"] {
    opacity: 0.5;
}

.command-palette-item:disabled {
    cursor: not-allowed;
}

.quick-open[data-open="true"] {
    opacity: 1;
    pointer-events: auto;
    transform: translate(-50%, 0);
}

.quick-open-head {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: var(--space-8);
}

.quick-open-title {
    margin: 0;
    font-size: var(--text-size-2xs);
    letter-spacing: 0.7px;
    text-transform: uppercase;
    color: var(--text);
}

.quick-open-sub {
    margin: 0;
    font-size: var(--text-size-xs);
    color: var(--muted);
}

#quickOpenInput,
#commandPaletteInput,
#editorFindInput,
#editorReplaceInput,
#symbolSearchInput,
#snippetTriggerInput,
#projectSearchInput,
#projectReplaceInput,
#promptDialogInput {
    width: 100%;
    height: var(--control-height-xl);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-strong);
    background: var(--surface-panel-alt);
    color: var(--text);
    padding: 0 var(--space-12);
    font-size: var(--text-size-xs);
}

#quickOpenInput:focus-visible,
#commandPaletteInput:focus-visible,
#editorFindInput:focus-visible,
#editorReplaceInput:focus-visible,
#symbolSearchInput:focus-visible,
#snippetTriggerInput:focus-visible,
#projectSearchInput:focus-visible,
#projectReplaceInput:focus-visible,
#promptDialogInput:focus-visible {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 2px var(--ring-focus);
}

.editor-search-panel,
.symbol-palette,
.project-search-panel {
    width: var(--modal-width-lg);
}

:is(#editorSearchPanel, #symbolPalette, #projectSearchPanel) {
    border-radius: 0;
    border-color: var(--border-control);
    background: var(--menu-bg);
    box-shadow: var(--menu-shadow);
    padding: var(--space-10);
    gap: var(--space-8);
}

:is(#editorSearchPanel, #symbolPalette, #projectSearchPanel) .quick-open-head {
    align-items: center;
    padding-bottom: var(--space-6);
    border-bottom: 1px solid var(--border-soft);
}

:is(#editorSearchPanel, #symbolPalette, #projectSearchPanel) .quick-open-title {
    font-size: var(--text-size-2xs);
    letter-spacing: 0.45px;
}

:is(#editorSearchPanel, #symbolPalette, #projectSearchPanel) .quick-open-sub {
    font-size: var(--text-size-2xs);
    color: var(--text-muted-quiet);
}

:is(#editorSearchPanel, #symbolPalette, #projectSearchPanel) .editor-search-grid {
    gap: var(--space-6);
}

#editorSearchPanel #editorFindInput,
#editorSearchPanel #editorReplaceInput,
#symbolPalette #symbolSearchInput,
#projectSearchPanel #projectSearchInput,
#projectSearchPanel #projectReplaceInput {
    height: var(--control-height-md);
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--surface-panel);
    color: var(--text);
    padding: 0 var(--space-8);
    font-size: var(--text-size-xs);
}

#editorSearchPanel #editorFindInput:focus-visible,
#editorSearchPanel #editorReplaceInput:focus-visible,
#symbolPalette #symbolSearchInput:focus-visible,
#projectSearchPanel #projectSearchInput:focus-visible,
#projectSearchPanel #projectReplaceInput:focus-visible {
    border-color: var(--btn-pressed-border);
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

:is(#editorSearchPanel, #symbolPalette, #projectSearchPanel) .editor-search-controls {
    gap: var(--space-6);
}

:is(#editorSearchPanel, #symbolPalette, #projectSearchPanel) .editor-search-controls button {
    min-height: var(--control-height-md);
    padding: var(--space-6) var(--space-8);
    border-radius: 0;
    border: 1px solid transparent;
    background: transparent;
    font-size: var(--text-size-4xs-plus);
    font-weight: 600;
    letter-spacing: var(--letter-spacing-tight);
}

:is(#editorSearchPanel, #symbolPalette, #projectSearchPanel) .editor-search-controls button:hover {
    border-color: var(--btn-primary-border);
    background: var(--surface-active);
}

#editorSearchPanel .editor-search-controls button[aria-pressed="true"] {
    border-color: var(--btn-pressed-border);
    background: var(--surface-selected);
    color: var(--btn-pressed-text);
}

#editorSearchPanel .quick-open-hint {
    margin-top: var(--space-2);
    padding: var(--space-6) var(--space-8);
    border-radius: 0;
    border: 1px solid var(--border-soft);
    background: var(--surface-panel);
    color: var(--text-muted-soft);
    font-size: var(--text-size-2xs);
}

#symbolPalette .quick-open-list {
    border-radius: 0;
    border-color: var(--border-control);
    background: var(--surface-panel);
    padding: 0;
    gap: 0;
}

#symbolPalette .quick-open-item {
    border-radius: 0;
    border: 1px solid transparent;
    padding: var(--space-7) var(--space-8);
}

#symbolPalette .quick-open-item-wrap + .quick-open-item-wrap .quick-open-item {
    border-top: 1px solid var(--border-soft);
}

#symbolPalette .quick-open-item:hover {
    border-color: transparent;
    background: var(--files-option-hover-bg);
}

#symbolPalette .quick-open-item[data-active="true"] {
    border-color: transparent;
    background: var(--files-option-selected-bg);
    color: var(--files-option-selected-text);
}

#symbolPalette .quick-open-empty {
    padding: var(--space-10) var(--space-8);
}

#symbolPalette .symbol-row-kind {
    color: var(--text-muted-quiet);
}

#symbolPalette .quick-open-hint {
    margin-top: var(--space-2);
    padding: var(--space-6) var(--space-8);
    border-radius: 0;
    border: 1px solid var(--border-soft);
    background: var(--surface-panel);
    color: var(--text-muted-soft);
    font-size: var(--text-size-2xs);
}

#projectSearchPanel .editor-search-controls button[aria-pressed="true"] {
    border-color: var(--btn-pressed-border);
    background: var(--surface-selected);
    color: var(--btn-pressed-text);
}

#projectSearchPanel .quick-open-list {
    border-radius: 0;
    border-color: var(--border-control);
    background: var(--surface-panel);
    padding: 0;
    gap: 0;
}

#projectSearchPanel .project-search-item {
    border-radius: 0;
    border: 1px solid transparent;
    padding: var(--space-7) var(--space-8);
}

#projectSearchPanel .quick-open-item-wrap + .quick-open-item-wrap .project-search-item {
    border-top: 1px solid var(--border-soft);
}

#projectSearchPanel .project-search-item:hover {
    border-color: transparent;
    background: var(--files-option-hover-bg);
}

#projectSearchPanel .project-search-item[data-active="true"] {
    border-color: transparent;
    background: var(--files-option-selected-bg);
    color: var(--files-option-selected-text);
}

#projectSearchPanel .project-search-item input[type="checkbox"] {
    width: 14px;
    height: 14px;
    margin: 0;
    accent-color: var(--accent);
}

#projectSearchPanel .project-search-preview {
    color: var(--text-muted-quiet);
}

#projectSearchPanel .quick-open-hint {
    margin-top: var(--space-2);
    padding: var(--space-6) var(--space-8);
    border-radius: 0;
    border: 1px solid var(--border-soft);
    background: var(--surface-panel);
    color: var(--text-muted-soft);
    font-size: var(--text-size-2xs);
}

.prompt-dialog {
    top: clamp(72px, 18vh, 180px);
    width: min(560px, calc(100vw - 24px));
    z-index: 1540;
    border-radius: 0;
}

#promptDialog[data-mode="confirm"] {
    width: fit-content;
    min-width: min(360px, calc(100vw - 24px));
    max-width: min(500px, calc(100vw - 24px));
}

#promptDialog[data-mode="prompt"] {
    width: min(560px, calc(100vw - 24px));
}

#promptDialog .quick-open-title {
    font-size: var(--text-size-xs);
    letter-spacing: 0.5px;
}

#promptDialog .quick-open-sub {
    font-size: var(--text-size-xs);
}

.prompt-dialog-message {
    margin: 0;
    font-size: var(--text-size-xs);
    line-height: 1.45;
    white-space: pre-line;
    color: var(--text-muted-soft);
}

.prompt-dialog-message[data-visible="false"] {
    display: none;
}

.prompt-dialog-list {
    display: none;
    margin: 0;
    padding: 0;
}

.prompt-dialog-list[data-open="true"] {
    display: block;
}

.prompt-dialog-list-title {
    margin: 0 0 var(--space-6);
    font-size: var(--text-size-3xs-plus);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--muted);
}

.prompt-dialog-list ul {
    margin: 0;
    padding: var(--space-8) var(--space-10);
    list-style: none;
    border-radius: 0;
    border: 1px solid var(--border);
    background: var(--surface-panel);
    max-height: 210px;
    overflow: auto;
}

.prompt-dialog-list li {
    margin: 0;
    font-size: var(--text-size-xs);
    line-height: 1.45;
    color: var(--text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.prompt-dialog-list li + li {
    margin-top: var(--space-4);
}

.prompt-dialog-input-wrap {
    display: none;
}

.prompt-dialog-input-wrap[data-open="true"] {
    display: block;
}

.prompt-dialog-error {
    margin: 0;
    min-height: 18px;
    font-size: var(--text-size-xs);
    color: var(--danger);
}

.prompt-dialog-error[data-visible="false"] {
    visibility: hidden;
}

.prompt-dialog-actions {
    display: flex;
    justify-content: flex-start;
    gap: var(--space-8);
}

#promptDialog[data-mode="confirm"] .quick-open-head {
    justify-content: center;
}

#promptDialog[data-mode="confirm"] .quick-open-title,
#promptDialog[data-mode="confirm"] .quick-open-sub,
#promptDialog[data-mode="confirm"] .prompt-dialog-message,
#promptDialog[data-mode="confirm"] .prompt-dialog-list-title,
#promptDialog[data-mode="confirm"] .prompt-dialog-list li,
#promptDialog[data-mode="confirm"] .prompt-dialog-error {
    text-align: center;
}

#promptDialog[data-mode="confirm"] .prompt-dialog-list ul {
    text-align: center;
}

#promptDialog[data-mode="confirm"] .prompt-dialog-actions {
    justify-content: center;
}

#promptDialog[data-mode="confirm"] .prompt-dialog-secondary[data-variant="danger"] {
    margin-left: 0;
}

#promptDialogCancel {
    order: 1;
}

#promptDialogConfirm {
    order: 2;
}

#promptDialog .prompt-dialog-secondary {
    order: 3;
}

#promptDialog .prompt-dialog-secondary[data-variant="danger"] {
    margin-left: auto;
}

#promptDialogInput,
#promptDialogCancel,
#promptDialog .prompt-dialog-secondary,
#promptDialogConfirm {
    border-radius: 0;
    font-size: var(--text-size-xs);
}

#promptDialog .prompt-dialog-secondary[data-visible="false"] {
    display: none;
}

#promptDialog .prompt-dialog-secondary {
    position: relative;
    overflow: hidden;
    isolation: isolate;
    transform-style: preserve-3d;
    perspective: 600px;
    transition: border-color var(--motion-base) var(--motion-ease), background var(--motion-base) var(--motion-ease), color var(--motion-base) var(--motion-ease), box-shadow var(--motion-base) var(--motion-ease);
}

#promptDialog .prompt-dialog-secondary[data-armable="true"]::before {
    content: attr(data-shield-label);
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding-inline: var(--space-6);
    pointer-events: none;
    font-family: var(--font);
    font-size: var(--text-size-xs);
    font-weight: 700;
    letter-spacing: 0.62px;
    text-transform: uppercase;
    white-space: nowrap;
    text-align: center;
    color: var(--prompt-cover-text);
    text-shadow: var(--prompt-cover-text-shadow);
    background: var(--prompt-cover-bg);
    border-bottom: 1px solid var(--prompt-cover-border);
    box-shadow: var(--prompt-cover-shadow);
    backdrop-filter: blur(2px);
    transform-origin: top center;
    transform: translateY(0) rotateX(0deg);
    transition: transform var(--motion-slow) var(--motion-ease), opacity var(--motion-slow) var(--motion-ease), border-color var(--motion-base) var(--motion-ease);
    z-index: 2;
}

#promptDialog .prompt-dialog-secondary[data-armable="true"] {
    border-color: var(--prompt-arm-border);
    background: var(--prompt-arm-bg);
    color: var(--prompt-arm-text);
    font-weight: 700;
    letter-spacing: 0.28px;
    padding-right: calc(var(--space-10) * 7);
    box-shadow: var(--prompt-arm-shadow);
}

#promptDialog .prompt-dialog-secondary[data-armable="true"]::after {
    content: attr(data-armed-label);
    position: absolute;
    top: 50%;
    right: var(--space-8);
    min-width: calc(var(--space-10) * 5);
    padding: var(--space-2) var(--space-6);
    border: 1px solid var(--prompt-badge-border);
    border-radius: 0;
    background: var(--prompt-badge-bg);
    color: var(--prompt-badge-text);
    font-size: var(--text-size-5xs);
    font-weight: 700;
    letter-spacing: 0.48px;
    text-transform: uppercase;
    text-align: center;
    line-height: 1;
    opacity: 0;
    transform: translate(6px, -50%) scale(0.96);
    transition: opacity var(--motion-ui) var(--motion-ease), transform var(--motion-ui) var(--motion-ease), border-color var(--motion-base) var(--motion-ease), background var(--motion-base) var(--motion-ease);
    z-index: 3;
    pointer-events: none;
    box-shadow: var(--prompt-badge-shadow);
}

#promptDialog .prompt-dialog-secondary[data-armable="true"]:hover::before {
    border-bottom-color: var(--prompt-cover-hover-border);
}

#promptDialog .prompt-dialog-secondary[data-armable="true"][data-armed="true"]::before {
    transform: translateY(-10px) rotateX(-112deg);
    opacity: 0;
}

#promptDialog .prompt-dialog-secondary[data-armable="true"][data-armed="true"] {
    border-color: var(--prompt-armed-border);
    background: var(--prompt-armed-bg);
    color: var(--prompt-armed-text);
    box-shadow: var(--prompt-armed-shadow);
    animation: prompt-launch-pulse 1.3s ease-in-out infinite;
}

#promptDialog .prompt-dialog-secondary[data-armable="true"][data-armed="true"]::after {
    opacity: 1;
    transform: translate(0, -50%) scale(1);
}

#promptDialog .prompt-dialog-secondary[data-armable="true"][data-armed="true"]:hover {
    border-color: var(--prompt-armed-hover-border);
}

@keyframes prompt-launch-pulse {
    0%,
    100% {
        box-shadow: var(--prompt-armed-pulse-start);
    }
    50% {
        box-shadow: var(--prompt-armed-pulse-end);
    }
}

#promptDialogConfirm[data-variant="danger"] {
    border-color: var(--prompt-danger-border);
    color: var(--danger-contrast-text);
    background: var(--prompt-danger-bg);
}

#promptDialogConfirm[data-variant="danger"]:hover,
#promptDialog .prompt-dialog-secondary[data-variant="danger"]:hover {
    border-color: var(--prompt-danger-hover-border);
    background: var(--prompt-danger-bg-hover);
}

#promptDialog .prompt-dialog-secondary[data-variant="danger"] {
    border-color: var(--prompt-danger-border);
    color: var(--danger-contrast-text);
    background: var(--prompt-danger-bg);
}

.editor-search-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-8);
}

.editor-search-controls {
    display: flex;
    align-items: center;
    gap: var(--space-6);
    flex-wrap: wrap;
}

.editor-search-controls button {
    min-height: var(--control-height-sm);
    padding: var(--space-6) var(--space-10);
    font-size: var(--text-size-2xs);
}

.editor-search-controls button[aria-pressed="true"] {
    border-color: var(--border-focus);
    color: var(--btn-pressed-text);
}

.quick-open-list {
    margin: 0;
    padding: var(--space-2);
    list-style: none;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--surface-panel);
    max-height: min(52vh, 420px);
    overflow: auto;
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.quick-open-item-wrap {
    margin: 0;
}

.quick-open-group {
    margin: var(--space-6) var(--space-4) var(--space-2);
    padding: var(--space-3) var(--space-6);
    font-size: var(--text-size-xs);
    font-weight: 700;
    letter-spacing: 0.22px;
    text-transform: uppercase;
    color: var(--text);
    border-left: 2px solid var(--border-soft);
    border-radius: var(--radius-xs);
    background: color-mix(in srgb, var(--surface-active) 38%, transparent);
    box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--border-soft) 42%, transparent);
}

.quick-open-item {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-10);
    padding: var(--space-8) var(--space-10);
    border-radius: var(--radius-sm);
    border: 1px solid transparent;
    background: transparent;
    color: var(--text);
    text-align: left;
}

.quick-open-item:hover {
    border-color: var(--border-strong);
    background: var(--surface-soft-hover);
}

.quick-open-item[data-active="true"] {
    border-color: var(--btn-pressed-border);
    background: var(--surface-active);
}

.quick-open-name {
    font-family: var(--font);
    font-size: var(--text-size-2xs);
    font-weight: 500;
    line-height: 1.3;
}

.quick-open-meta {
    font-size: var(--text-size-3xs);
    color: var(--muted);
    white-space: nowrap;
}

.quick-open-empty {
    padding: var(--space-14) var(--space-10);
    color: var(--muted);
    font-size: var(--text-size-xs);
}

.quick-open-hint {
    margin: 0;
    font-size: var(--text-size-2xs);
    color: var(--muted);
}

@media (max-width: 640px) {
    .quick-open {
        top: 10px;
        width: calc(100vw - 16px);
        padding: var(--space-10);
        border-radius: var(--radius-sm);
    }

    #quickOpenInput,
    #commandPaletteInput,
    #topCommandPaletteInput,
    #editorFindInput,
    #editorReplaceInput,
    #symbolSearchInput,
    #snippetTriggerInput,
    #projectSearchInput,
    #projectReplaceInput {
        height: 34px;
        font-size: var(--text-size-xs);
    }

    .editor-search-grid {
        grid-template-columns: 1fr;
    }

    #editorPanel[data-editor-split="true"] .editor-pane {
        grid-template-columns: 1fr;
    }

    .quick-open-list {
        max-height: 50vh;
    }

    .command-palette,
    .editor-search-panel,
    .symbol-palette,
    .project-search-panel {
        width: calc(100vw - 16px);
    }

    .snippet-manager-grid {
        grid-template-columns: 1fr;
    }
}

.shortcut-help-panel {
    left: 50%;
    right: auto;
    top: 50%;
    width: var(--modal-width-sm);
    max-height: min(720px, var(--modal-viewport-max-height));
    transform: translate(-50%, -50%);
    z-index: 1380;
    overflow: hidden;
}

.lesson-stats-panel {
    left: 50%;
    right: auto;
    top: 50%;
    width: min(var(--modal-width-md), calc(100vw - 24px));
    max-height: min(760px, var(--modal-viewport-max-height));
    transform: translate(-50%, -50%);
    z-index: 1380;
    overflow-x: hidden;
    overflow-y: auto;
}

.editor-history-panel,
.editor-settings-panel {
    left: 50%;
    right: auto;
    top: 50%;
    width: var(--modal-width-md);
    max-height: min(760px, var(--modal-viewport-max-height));
    transform: translate(-50%, -50%);
    z-index: 1380;
    overflow: hidden;
}

.editor-history-actions {
    display: flex;
    gap: var(--space-6);
    flex-wrap: wrap;
}

.editor-history-list {
    margin: 0;
    padding: 0;
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
    max-height: 240px;
    overflow: auto;
}

.editor-history-row {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: var(--space-10);
    align-items: center;
    padding: var(--space-8) var(--space-10);
    border-radius: var(--radius-sm);
    border: 1px solid var(--panel-item-border);
    background: var(--panel-item-bg);
}

.editor-history-row[data-active="true"] {
    border-color: var(--btn-pressed-border);
    background: var(--surface-active);
}

.editor-history-meta {
    font-size: var(--text-size-2xs);
    color: var(--muted);
}

.editor-history-diff {
    margin: 0;
    min-height: 140px;
    max-height: 280px;
    overflow: auto;
    padding: var(--space-10);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--surface-panel);
    color: var(--text);
    font-family: var(--font);
    font-size: var(--text-size-xs);
    line-height: 1.45;
}

:is(#editorHistoryPanel, #shortcutHelpPanel, #editorSettingsPanel, #lessonStatsPanel) {
    border-radius: var(--modal-radius);
    border-color: var(--modal-border-color);
    background: var(--modal-surface);
    box-shadow: var(--modal-shadow);
    padding: var(--modal-padding);
    gap: var(--modal-gap);
}

:is(#editorHistoryPanel, #shortcutHelpPanel, #editorSettingsPanel, #lessonStatsPanel) .layout-header {
    align-items: flex-start;
    min-height: var(--modal-header-min-height);
    overflow-x: auto;
    overflow-y: hidden;
    padding-top: var(--modal-header-padding-y);
    padding-bottom: var(--modal-header-padding-y);
    border-bottom: 1px solid var(--modal-header-border);
}

:is(#editorHistoryPanel, #shortcutHelpPanel, #editorSettingsPanel, #lessonStatsPanel) .layout-header > div {
    min-width: 0;
    flex: 1 1 auto;
}

:is(#editorHistoryPanel, #shortcutHelpPanel, #editorSettingsPanel, #lessonStatsPanel) .layout-title {
    font-size: var(--text-size-2xs);
    letter-spacing: 0.45px;
    text-transform: uppercase;
}

:is(#editorHistoryPanel, #shortcutHelpPanel, #editorSettingsPanel, #lessonStatsPanel) .layout-sub {
    font-size: var(--text-size-2xs);
    color: var(--text-muted-quiet);
}

:is(#editorHistoryPanel, #shortcutHelpPanel, #editorSettingsPanel, #lessonStatsPanel) :is(.layout-title, .layout-sub) {
    line-height: 1.35;
}

#lessonStatsPanel .lesson-stats-body {
    min-height: 0;
    gap: var(--space-10);
    overflow-x: hidden;
    overflow-y: auto;
}

#lessonStatsPanel :is(
    .lesson-stats-tab,
    .lesson-shop-header,
    .lesson-shop-meta strong,
    .lesson-shop-meta span,
    .lesson-stats-hero-title,
    .lesson-stats-hero-sub,
    .lesson-stats-next-label,
    .lesson-stats-safety,
    .lesson-stats-label,
    .lesson-stats-card strong,
    .lesson-stats-session-title,
    .lesson-stats-line,
    .lesson-stats-line strong
) {
    font-family: var(--font);
    -webkit-font-smoothing: antialiased;
}

#lessonStatsPanel :is(.lesson-stats-next-label, .lesson-stats-card strong, .lesson-stats-line strong) {
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum" 1;
}

.lesson-stats-tabs {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--space-8);
}

.lesson-stats-tab {
    min-height: 30px;
    border: 1px solid var(--panel-item-border);
    background: var(--panel-item-bg);
    color: var(--text-muted-soft);
    font-size: var(--text-size-xs);
    letter-spacing: 0.15px;
}

.lesson-stats-tab[data-active="true"] {
    border-color: var(--btn-pressed-border);
    background: var(--surface-selected-soft);
    color: var(--text-top-control);
}

.lesson-stats-view[hidden] {
    display: none;
}

.lesson-stats-view {
    display: grid;
    gap: var(--space-10);
}

.lesson-stats-shop {
    align-content: start;
}

.lesson-shop-header {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: var(--space-8);
    padding: var(--space-10);
    border: 1px solid var(--panel-item-border);
    background: var(--panel-item-bg);
}

.lesson-shop-header strong {
    font-size: var(--text-size-sm);
    color: var(--text-top-control);
}

.lesson-shop-header span {
    font-size: var(--text-size-2xs);
    color: var(--text-muted-soft);
}

.lesson-shop-list {
    margin: 0;
    padding: 0;
    list-style: none;
    display: grid;
    gap: var(--space-8);
}

.lesson-shop-item {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: var(--space-10);
    align-items: center;
    padding: var(--space-10);
    border: 1px solid var(--panel-item-border);
    background: var(--panel-item-bg);
}

.lesson-shop-meta {
    display: grid;
    gap: var(--space-2);
    min-width: 0;
}

.lesson-shop-meta strong {
    font-size: var(--text-size-xs);
    color: var(--text-top-control);
}

.lesson-shop-meta span {
    font-size: var(--text-size-2xs);
    color: var(--text-muted-soft);
}

.lesson-shop-action {
    min-width: 82px;
}

.lesson-stats-hero {
    display: grid;
    gap: var(--space-6);
    padding: var(--space-10);
    border: 1px solid var(--border-soft);
    background: linear-gradient(
        145deg,
        color-mix(in srgb, var(--surface-selected-soft) 18%, var(--surface-panel) 82%),
        color-mix(in srgb, var(--surface-raised) 80%, transparent)
    );
}

.lesson-stats-hero-title {
    margin: 0;
    font-size: var(--text-size-sm);
    color: var(--text-top-control);
    letter-spacing: 0.16px;
}

.lesson-stats-hero-sub {
    margin: 0;
    font-size: var(--text-size-xs);
    color: var(--text-muted-soft);
    line-height: 1.35;
}

.lesson-stats-next {
    display: grid;
    gap: var(--space-4);
}

.lesson-stats-next-label {
    font-size: var(--text-size-2xs);
    color: var(--text-muted-soft);
    letter-spacing: var(--letter-spacing-tight);
}

.lesson-stats-next-rail {
    position: relative;
    height: 6px;
    border: 1px solid var(--border-soft);
    background: color-mix(in srgb, var(--surface-panel) 88%, transparent);
    overflow: hidden;
}

.lesson-stats-next-fill {
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    width: var(--lesson-next-progress, 0%);
    background: linear-gradient(
        90deg,
        color-mix(in srgb, var(--surface-selected-soft) 44%, transparent),
        color-mix(in srgb, var(--text) 90%, transparent)
    );
    transition: width var(--motion-ui) var(--motion-ease);
}

.lesson-stats-safety {
    margin: 0;
    padding: var(--space-8) var(--space-10);
    border: 1px solid var(--border-soft);
    background: color-mix(in srgb, var(--surface-panel) 86%, transparent);
    color: var(--text-muted-soft);
    font-size: var(--text-size-2xs);
    line-height: 1.35;
}

.lesson-stats-grid {
    display: grid;
    grid-template-columns: repeat(4, minmax(120px, 1fr));
    gap: var(--space-8);
}

.lesson-stats-card {
    display: grid;
    gap: var(--space-4);
    padding: var(--space-10);
    border: 1px solid var(--panel-item-border);
    background: var(--panel-item-bg);
}

.lesson-stats-label {
    font-size: var(--text-size-2xs);
    color: var(--text-muted-soft);
    text-transform: uppercase;
    letter-spacing: 0.22px;
}

.lesson-stats-card strong {
    font-size: var(--text-size-sm);
    color: var(--text-top-control);
    line-height: 1.25;
}

.lesson-stats-session {
    border: 1px solid var(--border-soft);
    background: var(--surface-panel);
    padding: var(--space-10);
    display: grid;
    gap: var(--space-8);
}

.lesson-stats-session-title {
    margin: 0;
    font-size: var(--text-size-xs);
    color: var(--text-muted-soft);
    letter-spacing: 0.14px;
}

.lesson-stats-session-grid {
    display: grid;
    grid-template-columns: repeat(4, minmax(110px, 1fr));
    gap: var(--space-6);
}

.lesson-stats-line {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-6);
    min-height: 24px;
    padding: 0 var(--space-8);
    border: 1px solid var(--border-soft);
    background: color-mix(in srgb, var(--surface-panel) 88%, transparent);
    font-size: var(--text-size-2xs);
    color: var(--text-muted-soft);
}

.lesson-stats-line strong {
    color: var(--text-top-control);
    font-size: var(--text-size-xs);
}

@media (max-width: 900px) {
    .lesson-stats-grid {
        grid-template-columns: repeat(2, minmax(120px, 1fr));
    }

    .lesson-stats-session-grid {
        grid-template-columns: repeat(2, minmax(120px, 1fr));
    }
}

#editorHistoryPanel .layout-body {
    gap: var(--space-8);
}

#editorHistoryPanel .editor-history-actions {
    gap: var(--space-6);
}

#editorHistoryPanel .editor-history-actions button:hover {
    border-color: var(--btn-primary-border);
    background: var(--surface-active);
}

#editorHistoryPanel .editor-history-actions button:disabled {
    opacity: 0.45;
    cursor: not-allowed;
    border-color: transparent;
    background: transparent;
}

#editorHistoryPanel .editor-history-actions button:disabled:hover {
    border-color: transparent;
    background: transparent;
}

#editorHistoryPanel .editor-history-list {
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--surface-panel);
    padding: 0;
    gap: 0;
    max-height: min(36vh, 280px);
}

#editorHistoryPanel .editor-history-list > li {
    margin: 0;
    padding: 0;
}

#editorHistoryPanel .editor-history-row {
    border-radius: 0;
    border: 1px solid transparent;
    background: transparent;
    padding: var(--space-7) var(--space-8);
    text-align: left;
    width: 100%;
}

#editorHistoryPanel .editor-history-row:focus-visible {
    outline: none;
    box-shadow: inset 0 0 0 1px var(--btn-primary-border);
}

#editorHistoryPanel .editor-history-row + .editor-history-row {
    border-top: 1px solid var(--border-soft);
}

#editorHistoryPanel .editor-history-row:hover {
    border-color: transparent;
    background: var(--files-option-hover-bg);
}

#editorHistoryPanel .editor-history-row[data-active="true"] {
    border-color: transparent;
    background: var(--files-option-selected-bg);
    color: var(--files-option-selected-text);
}

#editorHistoryPanel .editor-history-meta {
    color: var(--text-muted-quiet);
}

#editorHistoryPanel .editor-history-main {
    display: flex;
    flex-direction: column;
    min-width: 0;
    gap: var(--space-2);
}

#editorHistoryPanel .editor-history-title,
#editorHistoryPanel .editor-history-reason {
    display: block;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

#editorHistoryPanel .editor-history-age {
    white-space: nowrap;
}

#editorHistoryPanel .editor-history-diff {
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--surface-panel);
    padding: var(--space-8);
}

#editorHistoryPanel .editor-history-actions button,
#shortcutHelpPanel #shortcutHelpClose,
#editorSettingsPanel .layout-header > button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: var(--control-height-md);
    padding: var(--space-6) var(--space-8);
    border-radius: 0;
    border: 1px solid transparent;
    background: transparent;
    font-size: var(--text-size-4xs-plus);
    font-weight: 600;
    letter-spacing: var(--letter-spacing-tight);
}

#editorHistoryPanel .editor-history-actions button:hover,
#shortcutHelpPanel #shortcutHelpClose:hover,
#editorSettingsPanel .layout-header > button:hover {
    border-color: var(--btn-primary-border);
    background: var(--surface-active);
}

#shortcutHelpPanel .layout-body,
#editorSettingsPanel .layout-body {
    gap: var(--space-8);
}

#shortcutHelpPanel .layout-group {
    gap: var(--space-6);
}

.editor-settings-panel .layout-body {
    gap: var(--space-12);
}

.editor-settings-panel .layout-toggle {
    justify-content: space-between;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: var(--space-8) var(--space-10);
    background: var(--surface-panel);
}

:is(#editorHistoryPanel, #shortcutHelpPanel, #editorSettingsPanel) .layout-header > button {
    align-self: center;
    margin-top: 0;
}

#editorSettingsPanel .layout-title {
    display: block;
}

#editorSettingsPanel .layout-sub {
    margin-top: 0;
}

#editorSettingsPanel .layout-body {
    padding-right: 0;
}

#editorSettingsPanel .layout-body > .layout-group:not(.snippet-manager-group),
#editorSettingsPanel .layout-body > .layout-row {
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--surface-panel);
    padding: var(--space-8);
    margin: 0;
}

#editorSettingsPanel .layout-body > .layout-group:not(.snippet-manager-group) {
    gap: var(--space-6);
}

#editorSettingsPanel .layout-body > .layout-row {
    grid-template-columns: minmax(0, 1fr) 96px;
    gap: var(--space-8);
    min-height: var(--control-height-md);
    align-items: center;
}

#editorSettingsPanel .layout-label {
    margin: 0;
    font-size: var(--text-size-2xs);
    letter-spacing: 0.32px;
    text-transform: uppercase;
    color: var(--text-muted-quiet);
}

#editorSettingsPanel .layout-row .layout-label {
    font-size: var(--text-size-2xs);
    letter-spacing: 0;
    text-transform: none;
    color: var(--text-muted-soft);
}

#editorSettingsPanel .editor-settings-number-group .layout-label {
    font-size: var(--text-size-2xs);
    letter-spacing: 0;
    text-transform: none;
    color: var(--text-muted-soft);
    white-space: nowrap;
}

#editorSettingsPanel .layout-select,
#editorSettingsPanel .layout-row input[type="number"] {
    box-sizing: border-box;
    width: 100%;
    height: var(--control-height-md);
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--surface-panel);
    color: var(--text);
    padding: 0 var(--space-8);
    font-size: var(--text-size-2xs);
    font-family: var(--font);
}

#editorSettingsPanel .layout-select:focus-visible,
#editorSettingsPanel .layout-row input[type="number"]:focus-visible {
    outline: none;
    border-color: var(--btn-pressed-border);
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

#editorSettingsPanel .layout-select option {
    font-family: var(--font);
}

#editorSettingsPanel .layout-row input[type="number"] {
    -moz-appearance: textfield;
    appearance: textfield;
    text-align: center;
    line-height: 1;
    font-variant-numeric: tabular-nums;
}

#editorSettingsPanel .editor-settings-number-group input[type="number"] {
    width: 100%;
    max-width: none;
    min-width: 0;
    height: var(--control-height-md);
    padding: 0 var(--space-8);
    background: var(--surface-panel);
}

#editorSettingsPanel .layout-row input[type="number"]::-webkit-outer-spin-button,
#editorSettingsPanel .layout-row input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

#editorSettingsPanel .layout-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-10);
    min-height: var(--control-height-md);
    border: 0;
    border-radius: 0;
    padding: 0;
    background: transparent;
    color: var(--text);
    font-size: var(--text-size-2xs);
}

#editorSettingsPanel .layout-toggle span {
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

#editorSettingsPanel .layout-toggle input[type="checkbox"] {
    width: 14px;
    height: 14px;
    margin: 0;
    accent-color: var(--accent);
}

#editorSettingsPanel .snippet-manager-group {
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--surface-panel);
    padding: var(--space-8);
    gap: var(--space-8);
    margin-top: 0;
}

#editorSettingsPanel .snippet-manager-grid {
    gap: var(--space-6);
    grid-template-columns: minmax(130px, 0.9fr) minmax(0, 1fr) auto;
    align-items: center;
}

#editorSettingsPanel #snippetTriggerInput {
    box-sizing: border-box;
    width: 100%;
    height: var(--control-height-md);
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--surface-panel);
    color: var(--text);
    padding: 0 var(--space-8);
    font-size: var(--text-size-2xs);
    font-family: var(--font);
}

#editorSettingsPanel #snippetTriggerInput:focus-visible {
    outline: none;
    border-color: var(--btn-pressed-border);
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

#editorSettingsPanel #snippetAdd {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    line-height: 1;
    min-height: var(--control-height-md);
    height: var(--control-height-md);
    min-width: 108px;
    padding: 0 var(--space-8);
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: transparent;
    color: var(--text);
    font-size: var(--text-size-4xs-plus);
    font-weight: 600;
    letter-spacing: var(--letter-spacing-tight);
}

#editorSettingsPanel #snippetAdd:hover {
    border-color: var(--btn-primary-border);
    background: var(--surface-active);
}

#editorSettingsPanel #snippetAdd:focus-visible {
    outline: none;
    border-color: var(--btn-pressed-border);
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

#editorSettingsPanel #snippetTemplateInput {
    width: 100%;
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--surface-panel);
    color: var(--text);
    padding: var(--space-8);
    min-height: 72px;
    font-size: var(--text-size-2xs);
    line-height: 1.45;
    font-family: var(--font);
    resize: vertical;
}

#editorSettingsPanel #snippetTemplateInput:focus-visible {
    outline: none;
    border-color: var(--btn-pressed-border);
    box-shadow: 0 0 0 2px var(--ring-focus-soft);
}

#editorSettingsPanel .snippet-list {
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--surface-panel);
    padding: 0;
    gap: 0;
    max-height: min(28vh, 220px);
}

#editorSettingsPanel .snippet-item {
    border-radius: 0;
    border: 1px solid transparent;
    background: transparent;
    padding: var(--space-7) var(--space-8);
    gap: var(--space-6);
}

#editorSettingsPanel .snippet-item + .snippet-item {
    border-top: 1px solid var(--border-soft);
}

#editorSettingsPanel .snippet-item:hover {
    border-color: transparent;
    background: var(--files-option-hover-bg);
}

#editorSettingsPanel .snippet-item-actions button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    line-height: 1;
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    padding: 0 var(--space-8);
    border-radius: 0;
    border: 1px solid transparent;
    background: transparent;
    font-size: var(--text-size-4xs-plus);
}

#editorSettingsPanel .snippet-item-actions button:hover {
    border-color: var(--btn-primary-border);
    background: var(--surface-active);
}

#editorSettingsPanel .snippet-item-scope {
    border-radius: 0;
    padding: var(--space-1) var(--space-5);
}

@media (max-width: 640px) {
    #editorSettingsPanel .layout-body > .layout-row {
        grid-template-columns: 1fr;
        gap: var(--space-6);
    }

    #editorSettingsPanel .editor-settings-number-group .layout-label {
        white-space: normal;
    }

    #editorSettingsPanel .snippet-manager-grid {
        grid-template-columns: 1fr;
    }

    #editorSettingsPanel #snippetAdd {
        width: 100%;
        min-width: 0;
    }
}

.symbol-row-kind {
    font-size: var(--text-size-4xs);
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-ui-strong);
}

.symbol-row-name {
    font-family: var(--font);
    font-size: var(--text-size-xs);
}

.project-search-item {
    width: 100%;
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: var(--space-8);
    padding: var(--space-8) var(--space-10);
    border-radius: var(--radius-sm);
    border: 1px solid transparent;
    background: transparent;
    color: var(--text);
    text-align: left;
}

.project-search-item:hover {
    border-color: var(--border-strong);
    background: var(--surface-soft-hover);
}

.project-search-item[data-active="true"] {
    border-color: var(--btn-pressed-border);
    background: var(--surface-active);
}

.symbol-refs-list {
    max-height: min(28vh, 220px);
}

.snippet-manager-group {
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: var(--space-10);
    background: var(--surface-panel);
    gap: var(--space-8);
}

.snippet-manager-grid {
    display: grid;
    grid-template-columns: 150px 1fr auto;
    gap: var(--space-8);
    align-items: center;
}

#snippetTemplateInput {
    width: 100%;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-strong);
    background: var(--surface-panel-alt);
    color: var(--text);
    padding: var(--space-8) var(--space-10);
    font-size: var(--text-size-xs);
    font-family: var(--font);
    resize: vertical;
    min-height: 64px;
}

#snippetTemplateInput:focus-visible {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 2px var(--ring-focus);
}

.snippet-list {
    margin: 0;
    padding: 0;
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
    max-height: 180px;
    overflow: auto;
}

.snippet-item {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: var(--space-8);
    align-items: center;
    padding: var(--space-8) var(--space-10);
    border-radius: var(--radius-sm);
    border: 1px solid var(--panel-item-border);
    background: var(--panel-item-bg);
}

.snippet-item-actions {
    display: inline-flex;
    align-items: center;
    gap: var(--space-6);
}

.snippet-item-actions button {
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    padding: 0 var(--space-8);
    font-size: var(--text-size-2xs);
}

.snippet-item-meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-6);
    align-items: center;
}

.snippet-item-trigger {
    font-family: var(--font);
    font-size: var(--text-size-2xs);
    color: var(--text);
}

.snippet-item-scope {
    font-size: var(--text-size-4xs);
    border: 1px solid var(--btn-pressed-border);
    border-radius: var(--radius-pill);
    padding: var(--space-1) var(--space-6);
    color: var(--btn-pressed-text);
}

.snippet-item-template {
    font-family: var(--font);
    font-size: var(--text-size-2xs);
    color: var(--muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.project-search-file {
    font-family: var(--font);
    font-size: var(--text-size-2xs);
}

.project-search-preview {
    font-size: var(--text-size-2xs);
    color: var(--muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.shortcut-help-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
    border: 0;
    background: transparent;
}

.shortcut-help-list li {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-10);
    padding: var(--space-8) var(--space-10);
    border-radius: 0;
    border: 0;
    background: var(--panel-item-bg);
    font-size: var(--text-size-xs);
}

.shortcut-help-list li:hover {
    background: var(--files-option-hover-bg);
}

.shortcut-help-list kbd {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: var(--control-height-compact);
    padding: 0 var(--space-7);
    border-radius: 0;
    border: 0;
    background: var(--kbd-bg);
    color: var(--text-top-control);
    font-size: var(--text-size-2xs);
    line-height: 1;
    white-space: nowrap;
}

.layout-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-12);
    overflow-x: auto;
    overflow-y: hidden;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb-hover) transparent;
    -webkit-overflow-scrolling: touch;
}

.layout-header::-webkit-scrollbar {
    height: var(--scrollbar-size);
}

.layout-header::-webkit-scrollbar-track {
    background: transparent;
}

.layout-header::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
}

.layout-header::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
}

.layout-header > * {
    flex: 0 0 auto;
    min-width: max-content;
}

.layout-title {
    margin: 0;
    font-size: var(--text-size-sm);
    font-weight: 700;
    color: var(--text);
}

.layout-sub {
    margin: var(--space-4) 0 0;
    font-size: var(--text-size-xs);
    color: var(--muted);
}

.layout-body {
    display: flex;
    flex-direction: column;
    gap: var(--space-14);
    min-height: 0;
    overflow-y: auto;
    padding-right: var(--space-2);
}

.layout-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
}

.layout-label {
    font-size: var(--text-size-xs);
    color: var(--muted);
}

.layout-row {
    display: grid;
    grid-template-columns: 1fr 80px;
    gap: var(--space-8);
    align-items: center;
}

.layout-select,
.layout-row input[type="number"] {
    appearance: none;
    border: 1px solid var(--border);
    background: var(--surface-elevated);
    color: var(--text);
    padding: var(--space-8) var(--space-10);
    border-radius: var(--radius-sm);
    font-size: var(--text-size-2xs);
    font-family: var(--font);
}

.layout-row input[type="range"] {
    width: 100%;
}

.layout-toggles {
    gap: var(--space-10);
}

.layout-toggle {
    display: flex;
    align-items: center;
    gap: var(--space-8);
    font-size: var(--text-size-xs);
    color: var(--muted);
}

.layout-actions {
    display: flex;
    justify-content: flex-end;
    padding-top: var(--space-4);
}

#layoutPanel .layout-header {
    align-items: flex-start;
    gap: var(--space-10);
    padding: 0 0 var(--space-8);
    border-bottom: 1px solid var(--border-soft);
}

#layoutPanel .layout-title {
    font-size: var(--text-size-5xs-plus);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-ui-strong);
    line-height: 1;
    color: var(--text-muted-quiet);
}

#layoutPanel .layout-sub {
    margin: var(--space-4) 0 0;
    font-size: var(--text-size-4xs);
    color: var(--muted);
}

#layoutPanel #layoutClose {
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    padding: 0 var(--space-9);
    border-radius: 0;
    border: 1px solid transparent;
    background: transparent;
    color: var(--text);
    font-size: var(--text-size-2xs);
    font-weight: 600;
}

#layoutPanel #layoutClose:hover {
    border-color: var(--btn-primary-border);
    background: var(--surface-active);
}

#layoutPanel .layout-body {
    gap: var(--space-8);
    padding-right: 0;
}

#layoutPanel .layout-group {
    gap: var(--space-6);
}

#layoutPanel .layout-group + .layout-group {
    margin-top: 0;
    padding-top: var(--space-8);
    border-top: 1px solid var(--border-soft);
}

#layoutPanel .layout-label {
    margin: 0;
    font-size: var(--text-size-5xs-plus);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-ui-strong);
    color: var(--text-muted-quiet);
}

#layoutPanel .layout-row {
    grid-template-columns: 1fr 74px;
    gap: var(--space-6);
}

#layoutPanel .layout-select,
#layoutPanel .layout-row input[type="number"] {
    box-sizing: border-box;
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--surface-panel);
    color: var(--text);
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    padding: 0 var(--space-8);
    font-size: var(--text-size-2xs);
    font-family: var(--font);
}

#layoutPanel .layout-row input[type="number"] {
    -moz-appearance: textfield;
    appearance: textfield;
    text-align: center;
    line-height: 1;
    font-variant-numeric: tabular-nums;
}

#layoutPanel .layout-row input[type="number"]::-webkit-outer-spin-button,
#layoutPanel .layout-row input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

#layoutPanel .layout-select:focus-visible,
#layoutPanel .layout-row input[type="number"]:focus-visible {
    outline: none;
    border-color: var(--btn-pressed-border);
    box-shadow: 0 0 0 1px var(--ring-focus-soft);
}

#layoutPanel .layout-toggle {
    justify-content: space-between;
    gap: var(--space-8);
    min-height: var(--control-height-xs);
    border: 1px solid transparent;
    border-radius: 0;
    padding: var(--space-4) var(--space-6);
    background: transparent;
    font-size: var(--text-size-2xs);
}

#layoutPanel .layout-toggle:hover {
    border-color: var(--btn-primary-border);
    background: var(--surface-active);
}

#layoutPanel .layout-toggle input[type="checkbox"] {
    width: 14px;
    height: 14px;
    margin: 0;
    accent-color: var(--accent);
}

#layoutPanel .layout-toggles {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--space-6);
    border-top: 1px solid var(--border-soft);
    padding-top: var(--space-8);
}

#layoutPanel .layout-row input[type="range"] {
    accent-color: var(--accent);
}

#layoutPanel .layout-actions {
    justify-content: flex-start;
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--space-6);
    padding-top: var(--space-8);
    margin-top: var(--space-2);
    border-top: 1px solid var(--border-soft);
}

#layoutPanel #layoutTutorial,
#layoutPanel #layoutReset {
    width: 100%;
    min-height: var(--control-height-md);
    height: var(--control-height-md);
    border-radius: 0;
    font-size: var(--text-size-2xs);
    letter-spacing: 0.15px;
}

.sandbox-layout {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
    flex: 1;
    min-height: 0;
    height: 100%;
}

.tools-panel .card-bd {
    display: flex;
    flex-direction: column;
    gap: var(--tools-gap);
    min-height: 0;
    overflow: hidden;
    overflow-x: hidden;
    padding: var(--tools-pad);
}

.tools-panel .tools-tabs {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: var(--tools-action-gap);
    min-width: 0;
}

.tools-panel .tools-tab {
    min-width: 0;
    min-height: var(--tools-action-min-height);
    padding: 0 var(--space-8);
    border-radius: 0;
    font-size: var(--tools-action-font-size);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.tools-panel .tools-tab[aria-selected="true"] {
    background: var(--btn-primary-bg);
    color: var(--btn-primary-text);
    border-color: var(--btn-primary-bg);
}

.tools-panel .tools-tab-panels {
    flex: 1 1 auto;
    min-height: 0;
    width: 100%;
    min-width: 0;
    display: flex;
    overflow: hidden;
}

.tools-panel .tools-tab-panels > [role="tabpanel"] {
    flex: 1 1 auto;
    min-height: 0;
    width: 100%;
}

.tools-panel .tools-tab-panels > [role="tabpanel"][hidden] {
    display: none !important;
}

.tools-panel .tools-problems-dock {
    display: flex;
    flex-direction: column;
    min-height: 0;
    width: 100%;
    border: 1px solid var(--panel-section-border);
    border-radius: 0;
    background: var(--panel-section-bg);
    overflow: hidden;
}

.tools-panel .tools-problems-toggle {
    width: 100%;
    min-height: var(--control-height-md);
    border-radius: 0;
    text-align: left;
    padding: 0 var(--space-10);
    font-size: var(--tools-action-font-size);
}

.tools-panel .tools-problems-dock[data-open="false"] #problemsPanel {
    display: none;
}

.tools-panel #problemsPanel {
    flex: 0 0 auto;
    min-height: 0;
    max-height: min(34vh, 300px);
    border: 0;
    border-top: 1px solid var(--panel-section-border);
}

.tools-panel #problemsPanel .diagnostics-list {
    max-height: min(24vh, 220px);
}

.tools-panel .card-bd::-webkit-scrollbar {
    width: var(--scrollbar-size);
}

.tools-panel .card-bd::-webkit-scrollbar-track {
    background: transparent;
}

.tools-panel .card-bd::-webkit-scrollbar-thumb {
    border-radius: var(--radius-pill);
    border: var(--scrollbar-thumb-border) solid transparent;
    background-clip: content-box;
    background: var(--scrollbar-thumb);
}

.tools-panel .card-bd::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
}

.tools-panel .diagnostics-header,
.tools-panel .inspect-header {
    display: grid;
    grid-template-columns: minmax(0, 1fr);
    align-items: start;
    gap: var(--tools-header-gap);
    margin-bottom: 0;
}

.tools-panel .diagnostics-header > div:first-child,
.tools-panel .inspect-header > div:first-child {
    min-width: 0;
    width: 100%;
}

.tools-panel .diagnostics-actions,
.tools-panel .inspect-actions {
    width: 100%;
    min-width: 0;
    margin-left: 0;
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--tools-action-gap);
    justify-content: stretch;
    align-items: stretch;
}

.tools-panel .diagnostics-actions button,
.tools-panel .inspect-actions button {
    min-width: 0;
    width: 100%;
    min-height: var(--tools-action-min-height);
    padding: 0 var(--space-8);
    font-size: var(--tools-action-font-size);
    white-space: normal;
    text-align: center;
}

.tools-panel .diagnostics-actions > .task-runner-status,
.tools-panel .inspect-actions > .inspect-status,
.tools-panel .diagnostics-actions > .dev-terminal-status {
    min-width: 0;
    width: 100%;
    min-height: var(--tools-action-min-height);
    padding: 0 var(--space-8);
    display: inline-flex;
    justify-content: center;
    align-items: center;
}

.tools-panel .inspect-panel,
.tools-panel .diagnostics-panel,
.tools-panel .problems-panel,
.tools-panel .task-runner-panel,
.tools-panel .debug-panel {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
    gap: var(--tools-section-gap);
    padding: var(--tools-section-pad);
    border-radius: 0;
    background: var(--panel-section-bg);
    border-color: var(--panel-section-border);
    color: var(--text);
    overflow: hidden;
}

.tools-panel .diagnostics-list,
.tools-panel .inspect-details {
    flex: 1 1 auto;
    min-height: 0;
    min-width: 0;
    overflow: auto;
}

.tools-panel .problems-panel .diagnostics-list,
.tools-panel .task-runner-panel .diagnostics-list,
.tools-panel .debug-panel .diagnostics-list,
.tools-panel .dev-terminal-panel .diagnostics-list {
    max-height: none;
}

.tools-panel .inspect-header {
    margin-bottom: 0;
}

.tools-panel .task-runner-actions {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--tools-action-gap);
}

.tools-panel .task-runner-actions button {
    min-height: var(--control-height-md);
    height: var(--control-height-md);
    min-width: 0;
    width: 100%;
    padding: 0 var(--space-8);
    white-space: normal;
}

.tools-panel .problem-item,
.tools-panel .debug-watch-item,
.tools-panel .task-runner-item {
    min-width: 0;
}

.tools-panel .problem-item-top,
.tools-panel .problem-item-location,
.tools-panel .problem-item-message,
.tools-panel .debug-watch-entry,
.tools-panel .inspect-details,
.tools-panel .diagnostics-list {
    overflow-wrap: anywhere;
    word-break: break-word;
}

.tools-panel .debug-watch-row {
    grid-template-columns: minmax(0, 1fr) minmax(96px, 34%);
    gap: var(--tools-action-gap);
}

.tools-panel .debug-watch-row button,
.tools-panel .debug-watch-remove {
    min-width: 0;
    width: 100%;
    white-space: normal;
}

.tools-panel .inspect-sub,
.tools-panel .diagnostics-sub,
.tools-panel .problem-item-location,
.tools-panel .task-runner-meta {
    color: var(--text-muted-soft);
}

.sandbox-layout > section {
    flex: 0 0 auto;
}

.sandbox-main {
    flex: 1 1 auto;
    min-height: 0;
    display: flex;
    height: 100%;
    background: transparent;
}

.sandbox-panel .card-bd {
    padding: 0;
    background: transparent;
}

.log-panel .card-bd {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
    min-height: 0;
}

.console-tabs {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    width: fit-content;
    max-width: 100%;
}

.console-tab {
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    padding: 0 var(--space-10);
    border-radius: 0;
    border: 1px solid var(--console-tab-border);
    background: var(--console-tab-bg);
    color: var(--console-tab-text);
    font-size: var(--text-size-2xs);
    font-weight: 600;
    line-height: 1;
}

.console-tab[data-active="true"],
.console-tab[aria-selected="true"] {
    border-color: var(--console-tab-active-border);
    background: var(--console-tab-active-bg);
    color: var(--console-tab-active-text);
    box-shadow: 0 0 0 1px var(--console-tab-active-glow), 0 0 10px var(--console-tab-active-glow);
}

.console-view {
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
}

.console-view[hidden] {
    display: none;
}

.console-view-log,
.console-terminal-view {
    min-height: 0;
}

.console-surface {
    min-height: 0;
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--log-bg);
    color: var(--log-text);
    border-radius: var(--radius-sm);
    border: 1px solid var(--log-border);
    overflow: hidden;
}

.console-filter-bar {
    display: grid;
    grid-template-columns: auto minmax(0, 1fr) auto;
    gap: var(--space-8);
    align-items: center;
    padding: var(--space-8) var(--space-10);
    border-bottom: 1px solid var(--log-border);
    background: color-mix(in srgb, var(--log-bg) 86%, var(--surface-panel-alt) 14%);
}

.console-filter-levels {
    display: inline-flex;
    align-items: center;
    gap: var(--space-4);
}

.console-filter-toggle,
.console-filter-jump {
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    padding: 0 var(--space-8);
    border-radius: 0;
    font-size: var(--text-size-3xs);
}

.console-filter-toggle[data-active="true"] {
    border-color: var(--console-tab-active-border);
    background: var(--console-tab-active-bg);
    color: var(--console-tab-active-text);
}

.console-filter-input {
    width: 100%;
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    border-radius: 0;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--log-text);
    padding: 0 var(--space-8);
    font-size: var(--text-size-2xs);
    font-family: var(--font);
}

.console-filter-input:focus-visible {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 2px var(--ring-focus);
}

.console-input-shell {
    display: grid;
    grid-template-columns: auto minmax(0, 1fr);
    gap: var(--space-10);
    align-items: start;
    min-height: 34px;
    padding: var(--space-5) var(--space-10);
    border-top: 1px solid var(--log-border);
    background: color-mix(in srgb, var(--log-bg) 86%, var(--surface-panel-alt) 14%);
}

.console-input-prompt {
    display: inline-flex;
    align-items: center;
    font-family: var(--font);
    font-size: var(--text-size-xs);
    font-weight: 700;
    line-height: 1.45;
    color: var(--accent-info);
    padding-left: var(--space-2);
    min-height: 24px;
    padding-top: var(--space-3);
}

#consoleInput {
    width: 100%;
    min-height: 24px;
    max-height: 120px;
    border-radius: 0;
    border: 0;
    background: transparent;
    color: var(--log-text);
    padding: var(--space-3) 0 var(--space-1);
    font-size: var(--text-size-xs);
    font-family: var(--font);
    line-height: 1.45;
    resize: none;
    overflow-y: auto;
    white-space: pre-wrap;
    box-sizing: border-box;
    margin: 0;
}

#consoleInput::placeholder {
    color: var(--text-muted-quiet);
}

#consoleInput:focus-visible {
    outline: none;
    box-shadow: none;
}

.log {
    margin: 0;
    padding: var(--space-12);
    /* Console fills panel while remaining readable */
    min-height: 0;
    flex: 1;
    overflow-y: auto;

    background: transparent;
    color: inherit;
    border-radius: 0;
    border: 0;

    font-family: var(--font);
    font-size: var(--text-size-2xs-plus);
    line-height: 1.5;

    white-space: pre-wrap;
    word-break: break-word;
}

.inspect-panel {
    padding: var(--panel-section-pad, var(--space-10));
    border: 1px solid var(--panel-section-border);
    border-radius: var(--radius-sm);
    background: var(--panel-section-bg);
    color: var(--muted);
    transition: border-color var(--motion-ui) var(--motion-ease), box-shadow var(--motion-ui) var(--motion-ease), color var(--motion-ui) var(--motion-ease);
}

.inspect-panel[data-inspecting="true"] {
    border-color: var(--status-success-border);
    box-shadow: 0 0 0 3px var(--status-success-ring);
    color: var(--text);
}

.inspect-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-12);
    margin-bottom: var(--space-10);
}

.inspect-actions {
    display: inline-flex;
    align-items: center;
    gap: var(--space-8);
}

.inspect-label {
    margin: 0;
    font-size: var(--text-size-xs);
    font-weight: 700;
    color: var(--text);
}

.inspect-sub {
    margin: var(--space-4) 0 0;
    font-size: var(--text-size-xs);
    color: var(--muted);
}

.inspect-status {
    font-size: var(--text-size-2xs);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    padding: var(--space-4) var(--space-8);
    border: 1px solid var(--border);
    border-radius: var(--radius-pill);
}

.inspect-panel[data-inspecting="true"] .inspect-status {
    border-color: var(--status-success-border);
    color: var(--status-success-text);
}

.inspect-details {
    font-family: var(--font);
    font-size: var(--text-size-xs);
    line-height: 1.5;
    color: var(--muted);
}

.inspect-target {
    font-size: var(--text-size-xs);
    color: var(--text);
}

.inspect-meta {
    margin: var(--space-6) 0;
}

.inspect-styles {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-12);
}

.inspect-text {
    margin: var(--space-8) 0 0;
    font-style: italic;
    color: var(--text-muted-soft);
}

/* Diagnostics */
.diagnostics-panel {
    padding: var(--panel-section-pad, var(--space-10));
    border: 1px solid var(--panel-section-border);
    border-radius: var(--radius-sm);
    background: var(--panel-section-bg);
    display: flex;
    flex-direction: column;
    gap: var(--space-10);
}

.diagnostics-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-12);
}

.diagnostics-actions {
    display: inline-flex;
    align-items: center;
    gap: var(--space-8);
}

.diagnostics-label {
    margin: 0;
    font-size: var(--text-size-xs);
    font-weight: 700;
    color: var(--text);
}

.diagnostics-sub {
    margin: var(--space-4) 0 0;
    font-size: var(--text-size-xs);
    color: var(--muted);
}

.diagnostics-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
    font-family: var(--font);
    font-size: var(--text-size-xs);
    line-height: 1.4;
    color: var(--muted);
}

.diagnostics-item {
    padding: var(--space-8) var(--space-10);
    border-radius: var(--radius-sm);
    border: 1px solid var(--panel-item-border);
    background: var(--panel-item-bg);
}

.diagnostics-item[data-level="warn"] {
    border-color: var(--status-warn-border);
    color: var(--status-warn-text);
}

.diagnostics-item[data-level="error"] {
    border-color: var(--status-danger-border);
    color: var(--danger);
}

.diagnostics-empty {
    padding: var(--space-8) var(--space-10);
    border-radius: var(--radius-sm);
    border: 1px dashed var(--border);
    color: var(--muted);
}

.problems-panel .diagnostics-list {
    max-height: 220px;
    overflow: auto;
}

.problem-item-wrap {
    list-style: none;
}

.problem-item {
    width: 100%;
    text-align: left;
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
    cursor: pointer;
}

.problem-item-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-10);
    font-size: var(--text-size-2xs);
}

.problem-item-source {
    text-transform: uppercase;
    letter-spacing: 0.55px;
    font-size: var(--text-size-4xs);
    color: var(--text-muted-soft);
}

.problem-item-location {
    color: var(--muted);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.problem-item-message {
    color: var(--text);
    line-height: 1.45;
}

.task-runner-panel .diagnostics-list {
    max-height: 190px;
    overflow: auto;
}

.task-runner-status {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 56px;
    padding: var(--space-4) var(--space-10);
    border-radius: var(--radius-pill);
    border: 1px solid var(--border);
    background: var(--surface-elevated-alt);
    color: var(--text-muted-soft);
    font-size: var(--text-size-4xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.45px;
}

.task-runner-status[data-state="busy"] {
    border-color: var(--status-warn-border);
    background: var(--status-warn-bg);
    color: var(--status-warn-text);
}

.task-runner-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: var(--space-8);
}

.tools-panel .task-runner-actions {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--tools-action-gap);
}

.task-runner-actions button {
    height: var(--control-height-sm);
    min-height: var(--control-height-sm);
    padding: 0 var(--space-8);
    font-size: var(--text-size-2xs);
}

.tools-panel .task-runner-actions button {
    min-width: 0;
    width: 100%;
    min-height: var(--control-height-md);
    height: var(--control-height-md);
    padding: 0 var(--space-8);
    font-size: var(--tools-action-font-size);
    white-space: normal;
}

.task-runner-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-5);
}

.task-runner-meta {
    font-size: var(--text-size-4xs);
    letter-spacing: var(--letter-spacing-ui);
    text-transform: uppercase;
    color: var(--text-muted-soft);
}

.task-runner-message {
    color: var(--text);
    line-height: 1.45;
}

.dev-terminal-panel .diagnostics-list {
    max-height: 200px;
    overflow: auto;
}

.dev-terminal-status {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 68px;
    padding: var(--space-4) var(--space-10);
    border-radius: 0;
    border: 1px solid var(--border);
    background: var(--surface-elevated-alt);
    color: var(--text-muted-soft);
    font-size: var(--text-size-4xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.45px;
}

.dev-terminal-status[data-state="safe"] {
    border-color: var(--status-info-border);
    background: var(--status-info-bg);
    color: var(--status-info-text);
}

.dev-terminal-status[data-state="locked"] {
    border-color: var(--status-danger-border);
    background: var(--status-danger-bg);
    color: var(--status-danger-text);
}

.dev-terminal-shell {
    display: grid;
    grid-template-columns: auto minmax(0, 1fr) auto;
    gap: var(--space-8);
    align-items: center;
}

.dev-terminal-prompt {
    font-family: var(--font);
    font-size: var(--text-size-xs);
    font-weight: 700;
    color: var(--accent-info);
    padding-left: var(--space-2);
}

#devTerminalInput {
    width: 100%;
    min-height: var(--control-height-md);
    border-radius: 0;
    border: 1px solid var(--border);
    background: var(--surface-panel-alt);
    color: var(--text);
    padding: 0 var(--space-10);
    font-size: var(--text-size-xs);
    font-family: var(--font);
}

#devTerminalInput:focus-visible {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 2px var(--ring-focus);
}

#devTerminalRun,
#devTerminalClear {
    min-height: var(--control-height-sm);
    height: var(--control-height-sm);
    padding: 0 var(--space-10);
    font-size: var(--text-size-2xs);
    border-radius: 0;
}

.dev-terminal-output {
    max-height: 190px;
    overflow: auto;
    gap: var(--space-5);
}

.log-panel .dev-terminal-panel {
    flex: 1;
    min-height: 0;
    margin: 0;
}

.log-panel .dev-terminal-panel .diagnostics-header {
    flex-wrap: wrap;
    align-items: flex-start;
    row-gap: var(--space-8);
}

.log-panel .dev-terminal-panel .diagnostics-actions {
    margin-left: auto;
    flex-wrap: wrap;
    row-gap: var(--space-6);
}

.log-panel .dev-terminal-output {
    flex: 1;
    min-height: 0;
    max-height: none;
    overflow: auto;
}

.dev-terminal-item {
    display: grid;
    grid-template-columns: auto minmax(0, 1fr);
    gap: var(--space-8);
    align-items: baseline;
}

.dev-terminal-meta {
    font-size: var(--text-size-4xs);
    letter-spacing: 0.28px;
    color: var(--muted);
    white-space: nowrap;
}

.dev-terminal-text {
    white-space: pre-wrap;
    overflow-wrap: anywhere;
    font-family: var(--font);
    color: var(--text);
}

.debug-panel .diagnostics-list {
    max-height: 140px;
    overflow: auto;
}

.debug-watch-row {
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto;
    align-items: center;
    gap: var(--space-8);
}

.tools-panel .debug-watch-row {
    grid-template-columns: minmax(0, 1fr) minmax(96px, 34%);
    gap: var(--tools-action-gap);
}

#debugWatchInput {
    width: 100%;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--surface-panel-alt);
    color: var(--text);
    padding: var(--field-pad-y) var(--field-pad-x);
    font-size: var(--text-size-xs);
}

#debugWatchInput:focus-visible {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 2px var(--ring-focus);
}

.debug-watch-item {
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto;
    gap: var(--space-8);
    align-items: center;
}

.debug-watch-entry {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.debug-watch-remove {
    min-height: var(--control-height-compact);
    height: var(--control-height-compact);
    padding: 0 var(--space-8);
    font-size: var(--text-size-4xs);
}

.debug-breakpoint-empty,
.debug-watch-empty {
    padding: var(--space-8) var(--space-10);
    border-radius: var(--radius-sm);
    border: 1px dashed var(--border);
    color: var(--muted);
}

/* Sandbox preview */
.runner-shell {
    position: relative;
    flex: 1;
    min-height: 0;
    display: flex;
    height: 100%;
    background: var(--surface-panel);
}

.runner-actions {
    position: absolute;
    top: var(--space-12);
    left: var(--space-12);
    display: inline-flex;
    align-items: center;
    gap: var(--space-8);
    z-index: 2;
    opacity: 0;
    pointer-events: none;
    transform: translateY(-4px);
    transition: opacity var(--motion-ui) var(--motion-ease), transform var(--motion-ui) var(--motion-ease);
}

.runner-shell:hover .runner-actions,
.runner-shell:focus-within .runner-actions {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
}

.runner-shell[data-tutorial-actions="true"] .runner-actions {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
}

.runner-actions button {
    padding: var(--space-6) var(--space-10);
    font-size: var(--text-size-xs);
    border-radius: var(--radius-sm);
    background: var(--surface-panel-alt);
}

.runner {
    width: 100%;
    min-height: 0;
    height: 100%;
    flex: 1;
    display: block;
    border: 0;
    border-radius: 0;
    background: var(--surface-panel);
    box-shadow: none;
    padding: 0;
    box-sizing: border-box;
}

.runner-exit {
    width: 36px;
    height: 36px;
    border-radius: var(--radius-pill);
    border: 1px solid var(--border);
    background: var(--surface-panel-alt);
    color: var(--text);
    font-size: var(--text-size-base);
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

.runner-shell[data-fullscreen="true"] {
    position: fixed;
    top: 50%;
    left: 50%;
    width: min(1280px, calc(100vw - 48px));
    height: calc(100vh - 48px);
    transform: translate(-50%, -50%);
    z-index: 1000;
    background: var(--bg);
    border-radius: var(--radius);
    border: 1px solid var(--border-soft);
    box-shadow: none;
    padding: var(--space-24);
}

.runner-shell[data-fullscreen="true"] .runner {
    min-height: 100%;
    height: 100%;
    border-radius: var(--radius-sm);
}

.runner-shell[data-fullscreen="true"] .runner-exit {
    display: inline-flex;
}

body.runner-fullscreen {
    overflow: hidden;
}

body.runner-fullscreen::before {
    content: "";
    position: fixed;
    inset: 0;
    background: var(--overlay-backdrop-strong);
    z-index: 900;
}

/* Quick header controls (shown when header is hidden) */
.quick-bar {
    position: fixed;
    top: calc(var(--space-8) + env(safe-area-inset-top, var(--space-0)));
    right: calc(var(--space-8) + env(safe-area-inset-right, var(--space-0)));
    display: inline-flex;
    align-items: center;
    gap: var(--space-6);
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--motion-layout) var(--motion-ease), transform var(--motion-layout) var(--motion-ease);
    transform: translateY(calc(var(--space-6) * -1));
    z-index: 1400;
}

.quick-bar[data-visible="true"] {
    opacity: 1;
    transform: translateY(0);
}

.quick-bar button {
    pointer-events: none;
    padding: var(--space-6) var(--space-10);
    font-size: var(--text-size-xs);
    min-height: var(--control-height-sm);
    border-radius: 0;
    border: 1px solid var(--border-control);
    background: var(--surface-panel);
}

.quick-bar[data-visible="true"] button {
    pointer-events: auto;
}



